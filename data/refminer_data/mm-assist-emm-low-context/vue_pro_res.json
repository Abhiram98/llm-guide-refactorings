[
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "9bba1ce8a4fb5c6f73cd92c9981039152a626bd6",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/9bba1ce8a4fb5c6f73cd92c9981039152a626bd6",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public selectOne() : CrmCustomerPoolConfigDO extracted from public getCustomerPoolConfig() : CrmCustomerPoolConfigDO in class cn.iocoder.yudao.module.crm.service.customer.CrmCustomerPoolConfigServiceImpl & moved to class cn.iocoder.yudao.module.crm.dal.mysql.customer.CrmCustomerPoolConfigMapper",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/customer/CrmCustomerPoolConfigServiceImpl.java",
                    "startLine": 30,
                    "endLine": 39,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public getCustomerPoolConfig() : CrmCustomerPoolConfigDO"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/customer/CrmCustomerPoolConfigServiceImpl.java",
                    "startLine": 38,
                    "endLine": 38,
                    "startColumn": 9,
                    "endColumn": 119,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/dal/mysql/customer/CrmCustomerPoolConfigMapper.java",
                    "startLine": 16,
                    "endLine": 18,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public selectOne() : CrmCustomerPoolConfigDO"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/dal/mysql/customer/CrmCustomerPoolConfigMapper.java",
                    "startLine": 17,
                    "endLine": 17,
                    "startColumn": 9,
                    "endColumn": 94,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/customer/CrmCustomerPoolConfigServiceImpl.java",
                    "startLine": 29,
                    "endLine": 37,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public getCustomerPoolConfig() : CrmCustomerPoolConfigDO"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/customer/CrmCustomerPoolConfigServiceImpl.java",
                    "startLine": 36,
                    "endLine": 36,
                    "startColumn": 16,
                    "endColumn": 52,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "customerPoolConfigMapper.selectOne()"
                }
            ],
            "isStatic": false
        },
        "ref_id": 1,
        "extraction_results": {
            "success": true,
            "newCommitHash": "a5b60c39ce0400a92b80070de8558daabc581acf",
            "newBranchName": "extract-selectOne-getCustomerPoolConfig-63db275"
        },
        "telemetry": {
            "id": "cf6fddbf-8338-41b4-af22-665ddefa58c3",
            "hostFunctionTelemetryData": {
                "hostFunctionSize": 54,
                "lineStart": 18,
                "lineEnd": 71,
                "bodyLineStart": 18,
                "language": "java",
                "filePath": "/Users/abhiram/Documents/TBE/evaluation_projects/ruoyi-vue-pro/yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/customer/CrmCustomerPoolConfigServiceImpl.java",
                "sourceCode": "/**\n * \u5ba2\u6237\u516c\u6d77\u914d\u7f6e Service \u5b9e\u73b0\u7c7b\n *\n * @author Wanwan\n */\n@Service\n@Validated\npublic class CrmCustomerPoolConfigServiceImpl implements CrmCustomerPoolConfigService {\n\n    @Resource\n    private CrmCustomerPoolConfigMapper customerPoolConfigMapper;\n\n    /**\n     * \u83b7\u5f97\u5ba2\u6237\u516c\u6d77\u914d\u7f6e\n     *\n     * @return \u5ba2\u6237\u516c\u6d77\u914d\u7f6e\n     */\n    @Override\n    public CrmCustomerPoolConfigDO getCustomerPoolConfig() {\n        // TODO @puhui999\uff1a\u8fd9\u4e2a\u8981\u641e\u5230 mapper \u91cc\u5662\u3002\n        return selectOne();\n    }\n\n    private CrmCustomerPoolConfigDO selectOne() {\n        return customerPoolConfigMapper.selectOne(new LambdaQueryWrapperX<CrmCustomerPoolConfigDO>().last(\"LIMIT 1\"));\n    }\n\n    /**\n     * \u4fdd\u5b58\u5ba2\u6237\u516c\u6d77\u914d\u7f6e\n     *\n     * @param saveReqVO \u66f4\u65b0\u4fe1\u606f\n     */\n    @Override\n    @LogRecord(type = CRM_CUSTOMER_POOL_CONFIG_TYPE, subType = CRM_CUSTOMER_POOL_CONFIG_SUB_TYPE, bizNo = \"{{#poolConfigId}}\",\n            success = CRM_CUSTOMER_POOL_CONFIG_SUCCESS)\n    public void saveCustomerPoolConfig(CrmCustomerPoolConfigSaveReqVO saveReqVO) {\n        // \u5b58\u5728\uff0c\u5219\u8fdb\u884c\u66f4\u65b0\n        CrmCustomerPoolConfigDO dbConfig = getCustomerPoolConfig();\n        CrmCustomerPoolConfigDO poolConfig = CrmCustomerConvert.INSTANCE.convert(saveReqVO);\n        if (Objects.nonNull(dbConfig)) {\n            customerPoolConfigMapper.updateById(poolConfig.setId(dbConfig.getId()));\n            // \u8bb0\u5f55\u64cd\u4f5c\u65e5\u5fd7\u4e0a\u4e0b\u6587\n            LogRecordContext.putVariable(\"isPoolConfigUpdate\", Boolean.TRUE);\n            LogRecordContext.putVariable(\"poolConfigId\", poolConfig.getId());\n            return;\n        }\n        // \u4e0d\u5b58\u5728\uff0c\u5219\u8fdb\u884c\u63d2\u5165\n        customerPoolConfigMapper.insert(poolConfig);\n        // \u8bb0\u5f55\u64cd\u4f5c\u65e5\u5fd7\u4e0a\u4e0b\u6587\n        LogRecordContext.putVariable(\"isPoolConfigUpdate\", Boolean.FALSE);\n        LogRecordContext.putVariable(\"poolConfigId\", poolConfig.getId());\n    }\n\n}"
            },
            "candidatesTelemetryData": {
                "numberOfSuggestions": 1,
                "candidates": [
                    {
                        "lineStart": 40,
                        "lineEnd": 42,
                        "refactoringType": "MyMoveMethodRefactoring",
                        "refactoringInfo": "Move method selectOne to class CrmCustomerPoolConfigMapper",
                        "description": "Move method selectOne to cn.iocoder.yudao.module.crm.dal.mysql.customer.CrmCustomerPoolConfigMapper\nRationale: The selectOne() method is directly interacting with the customerPoolConfigMapper to retrieve a single configuration, making it more appropriate for the CrmCustomerPoolConfigMapper class, which is responsible for data access operations.",
                        "couldCreateRefObject": true,
                        "applied": false,
                        "undone": false
                    }
                ]
            },
            "iterationData": [
                {
                    "iteration_num": 1,
                    "suggested_move_methods": [
                        {
                            "method_name": "selectOne",
                            "method_signature": "private CrmCustomerPoolConfigDO selectOne()",
                            "target_class": "CrmCustomerPoolConfigMapper",
                            "rationale": "The selectOne() method is primarily responsible for querying the database and should be part of the mapper class to adhere to the single responsibility principle."
                        }
                    ],
                    "llm_response_time": 2056
                },
                {
                    "iteration_num": 2,
                    "suggested_move_methods": [
                        {
                            "method_name": "selectOne",
                            "method_signature": "private CrmCustomerPoolConfigDO selectOne()",
                            "target_class": "CrmCustomerPoolConfigMapper",
                            "rationale": "The selectOne() method is primarily responsible for querying the database and should be part of the mapper class to adhere to the single responsibility principle."
                        }
                    ],
                    "llm_response_time": 1185
                },
                {
                    "iteration_num": 3,
                    "suggested_move_methods": [
                        {
                            "method_name": "selectOne",
                            "method_signature": "private CrmCustomerPoolConfigDO selectOne()",
                            "target_class": "CrmCustomerPoolConfigMapper",
                            "rationale": "The selectOne() method is primarily responsible for querying the database and should be part of the mapper class to adhere to the single responsibility principle."
                        }
                    ],
                    "llm_response_time": 1031
                },
                {
                    "iteration_num": -1,
                    "suggested_move_methods": [
                        {
                            "method_name": "selectOne",
                            "method_signature": "private CrmCustomerPoolConfigDO selectOne()",
                            "target_class": "CrmCustomerPoolConfigMapper",
                            "rationale": "The selectOne() method is primarily responsible for querying the database and should be part of the mapper class to adhere to the single responsibility principle."
                        }
                    ],
                    "llm_response_time": 0
                }
            ],
            "llmMethodPriority": {
                "priority_method_names": [
                    "selectOne"
                ],
                "llm_response_time": 492
            },
            "targetClassMap": {
                "selectOne": {
                    "target_classes": [
                        {
                            "class_name": "CrmCustomerPoolConfigMapper",
                            "similarity_score": 0.13900960937138318
                        }
                    ],
                    "target_classes_sorted_by_llm": [
                        "CrmCustomerPoolConfigMapper"
                    ],
                    "llm_response_time": 2166,
                    "similarity_computation_time": 2,
                    "similarity_metric": "cosine"
                }
            }
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "8b3bfcbd6b42530107b6f58d76f466ba521f11ca",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/8b3bfcbd6b42530107b6f58d76f466ba521f11ca",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public selectByUserIdAndSpuId(userId Long, spuId Long) : ProductBrowseHistoryDO extracted from public createBrowseHistory(userId Long, spuId Long) : void in class cn.iocoder.yudao.module.product.service.history.ProductBrowseHistoryServiceImpl & moved to class cn.iocoder.yudao.module.product.dal.mysql.history.ProductBrowseHistoryMapper",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/service/history/ProductBrowseHistoryServiceImpl.java",
                    "startLine": 28,
                    "endLine": 53,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public createBrowseHistory(userId Long, spuId Long) : void"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/service/history/ProductBrowseHistoryServiceImpl.java",
                    "startLine": 36,
                    "endLine": 36,
                    "startColumn": 117,
                    "endColumn": 149,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/service/history/ProductBrowseHistoryServiceImpl.java",
                    "startLine": 36,
                    "endLine": 36,
                    "startColumn": 74,
                    "endColumn": 107,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/service/history/ProductBrowseHistoryServiceImpl.java",
                    "startLine": 36,
                    "endLine": 36,
                    "startColumn": 9,
                    "endColumn": 158,
                    "codeElementType": "VARIABLE_DECLARATION_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/dal/mysql/history/ProductBrowseHistoryMapper.java",
                    "startLine": 23,
                    "endLine": 27,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public selectByUserIdAndSpuId(userId Long, spuId Long) : ProductBrowseHistoryDO"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/dal/mysql/history/ProductBrowseHistoryMapper.java",
                    "startLine": 26,
                    "endLine": 26,
                    "startColumn": 21,
                    "endColumn": 53,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/dal/mysql/history/ProductBrowseHistoryMapper.java",
                    "startLine": 25,
                    "endLine": 25,
                    "startColumn": 21,
                    "endColumn": 54,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/dal/mysql/history/ProductBrowseHistoryMapper.java",
                    "startLine": 24,
                    "endLine": 26,
                    "startColumn": 9,
                    "endColumn": 63,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/service/history/ProductBrowseHistoryServiceImpl.java",
                    "startLine": 29,
                    "endLine": 54,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public createBrowseHistory(userId Long, spuId Long) : void"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/service/history/ProductBrowseHistoryServiceImpl.java",
                    "startLine": 37,
                    "endLine": 37,
                    "startColumn": 42,
                    "endColumn": 99,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "browseHistoryMapper.selectByUserIdAndSpuId(userId,spuId)"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/dal/mysql/history/ProductBrowseHistoryMapper.java",
                    "startLine": 25,
                    "endLine": 25,
                    "startColumn": 21,
                    "endColumn": 54,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "added statement in extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/dal/mysql/history/ProductBrowseHistoryMapper.java",
                    "startLine": 26,
                    "endLine": 26,
                    "startColumn": 21,
                    "endColumn": 53,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "added statement in extracted method declaration",
                    "codeElement": null
                }
            ],
            "isStatic": false
        },
        "ref_id": 2,
        "extraction_results": {
            "success": true,
            "newCommitHash": "1bebd852ca5fde578332ee3106987ed1db303e5a",
            "newBranchName": "extract-selectByUserIdAndSpuId-createBrowseHistory-bbee720"
        },
        "telemetry": {
            "id": "d17b77bb-2c3a-4c82-b342-d7f04f0e9e9c",
            "hostFunctionTelemetryData": {
                "hostFunctionSize": 61,
                "lineStart": 15,
                "lineEnd": 75,
                "bodyLineStart": 15,
                "language": "java",
                "filePath": "/Users/abhiram/Documents/TBE/evaluation_projects/ruoyi-vue-pro/yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/service/history/ProductBrowseHistoryServiceImpl.java",
                "sourceCode": "/**\n * \u5546\u54c1\u6d4f\u89c8\u8bb0\u5f55 Service \u5b9e\u73b0\u7c7b\n *\n * @author owen\n */\n@Service\n@Validated\npublic class ProductBrowseHistoryServiceImpl implements ProductBrowseHistoryService {\n    private static final int USER_STORE_MAXIMUM = 100;\n\n    @Resource\n    private ProductBrowseHistoryMapper browseHistoryMapper;\n\n    @Override\n    public void createBrowseHistory(Long userId, Long spuId) {\n        // \u7528\u6237\u672a\u767b\u5f55\u65f6\u4e0d\u8bb0\u5f55\n        if (userId == null) {\n            return;\n        }\n\n        // \u60c5\u51b5\u4e00\uff1a\u540c\u4e00\u4e2a\u5546\u54c1\uff0c\u53ea\u4fdd\u7559\u6700\u65b0\u7684\u4e00\u6761\u8bb0\u5f55\n        ProductBrowseHistoryDO historyDO = selectByUserIdAndSpuId(userId, spuId);\n        if (historyDO != null) {\n            browseHistoryMapper.deleteById(historyDO);\n        } else {\n            // \u60c5\u51b5\u4e8c\uff1a\u9650\u5236\u6bcf\u4e2a\u7528\u6237\u7684\u6d4f\u89c8\u8bb0\u5f55\u7684\u6761\u6570\uff08\u53ea\u67e5\u4e00\u6761\u6700\u65e9\u5730\u8bb0\u5f55\u3001\u8bb0\u5f55\u603b\u6570\uff09\n            Page<ProductBrowseHistoryDO> pageResult = browseHistoryMapper.selectPageByUserIdOrderByCreateTimeAsc(userId, 1, 1);\n            if (pageResult.getTotal() >= USER_STORE_MAXIMUM) {\n                // \u5220\u9664\u6700\u65e9\u7684\u4e00\u6761\n                browseHistoryMapper.deleteById(CollUtil.getFirst(pageResult.getRecords()));\n            }\n        }\n\n        // \u63d2\u5165\n        ProductBrowseHistoryDO browseHistory = new ProductBrowseHistoryDO()\n                .setUserId(userId)\n                .setSpuId(spuId);\n        browseHistoryMapper.insert(browseHistory);\n    }\n\n    private ProductBrowseHistoryDO selectByUserIdAndSpuId(Long userId, Long spuId) {\n        ProductBrowseHistoryDO historyDO = browseHistoryMapper.selectOne(ProductBrowseHistoryDO::getUserId, userId, ProductBrowseHistoryDO::getSpuId, spuId);\n        return historyDO;\n    }\n\n    @Override\n    public void hideUserBrowseHistory(Long userId, Collection<Long> spuIds) {\n        browseHistoryMapper.updateUserDeletedByUserId(userId, spuIds, true);\n    }\n\n    @Override\n    public Long getBrowseHistoryCount(Long userId, Boolean userDeleted) {\n        return browseHistoryMapper.selectCountByUserIdAndUserDeleted(userId, userDeleted);\n    }\n\n    @Override\n    public PageResult<ProductBrowseHistoryDO> getBrowseHistoryPage(ProductBrowseHistoryPageReqVO pageReqVO) {\n        return browseHistoryMapper.selectPage(pageReqVO);\n    }\n\n}"
            },
            "candidatesTelemetryData": {
                "numberOfSuggestions": 0,
                "candidates": []
            },
            "processingTime": {
                "llmResponseTime": -1,
                "pluginProcessingTime": -1,
                "totalTime": 11488
            },
            "iterationData": [
                {
                    "iteration_num": 1,
                    "suggested_move_methods": [
                        {
                            "method_name": "createBrowseHistory",
                            "method_signature": "public void createBrowseHistory(Long userId, Long spuId)",
                            "target_class": "ProductBrowseHistoryManager",
                            "rationale": "The createBrowseHistory method contains business logic related to managing product browse history, which could be better encapsulated in a dedicated manager class responsible for handling browse history operations."
                        },
                        {
                            "method_name": "selectByUserIdAndSpuId",
                            "method_signature": "private ProductBrowseHistoryDO selectByUserIdAndSpuId(Long userId, Long spuId)",
                            "target_class": "ProductBrowseHistoryRepository",
                            "rationale": "The selectByUserIdAndSpuId method is primarily concerned with data retrieval, which aligns more closely with the responsibilities of a repository class."
                        }
                    ],
                    "llm_response_time": 2264
                },
                {
                    "iteration_num": 2,
                    "suggested_move_methods": [
                        {
                            "method_name": "createBrowseHistory",
                            "method_signature": "public void createBrowseHistory(Long userId, Long spuId)",
                            "target_class": "ProductBrowseHistoryManager",
                            "rationale": "The createBrowseHistory method contains business logic related to managing product browse history, which could be better encapsulated in a dedicated manager class responsible for handling browse history operations."
                        },
                        {
                            "method_name": "selectByUserIdAndSpuId",
                            "method_signature": "private ProductBrowseHistoryDO selectByUserIdAndSpuId(Long userId, Long spuId)",
                            "target_class": "ProductBrowseHistoryRepository",
                            "rationale": "The selectByUserIdAndSpuId method is primarily concerned with data retrieval, which aligns more closely with repository responsibilities. Moving it to a repository class would adhere to the single responsibility principle."
                        }
                    ],
                    "llm_response_time": 2355
                },
                {
                    "iteration_num": 3,
                    "suggested_move_methods": [
                        {
                            "method_name": "createBrowseHistory",
                            "method_signature": "public void createBrowseHistory(Long userId, Long spuId)",
                            "target_class": "ProductBrowseHistoryManager",
                            "rationale": "The createBrowseHistory method contains business logic related to managing product browse history, which could be better encapsulated in a dedicated manager class responsible for handling browse history operations."
                        },
                        {
                            "method_name": "selectByUserIdAndSpuId",
                            "method_signature": "private ProductBrowseHistoryDO selectByUserIdAndSpuId(Long userId, Long spuId)",
                            "target_class": "ProductBrowseHistoryRepository",
                            "rationale": "The selectByUserIdAndSpuId method is primarily concerned with data retrieval, which aligns more closely with repository responsibilities. Moving it to a repository class would adhere to the single responsibility principle."
                        }
                    ],
                    "llm_response_time": 2557
                },
                {
                    "iteration_num": -1,
                    "suggested_move_methods": [
                        {
                            "method_name": "createBrowseHistory",
                            "method_signature": "public void createBrowseHistory(Long userId, Long spuId)",
                            "target_class": "ProductBrowseHistoryManager",
                            "rationale": "The createBrowseHistory method contains business logic related to managing product browse history, which could be better encapsulated in a dedicated manager class responsible for handling browse history operations."
                        },
                        {
                            "method_name": "selectByUserIdAndSpuId",
                            "method_signature": "private ProductBrowseHistoryDO selectByUserIdAndSpuId(Long userId, Long spuId)",
                            "target_class": "ProductBrowseHistoryRepository",
                            "rationale": "The selectByUserIdAndSpuId method is primarily concerned with data retrieval, which aligns more closely with the responsibilities of a repository class."
                        }
                    ],
                    "llm_response_time": 0
                }
            ],
            "llmMethodPriority": {
                "priority_method_names": [
                    "selectByUserIdAndSpuId",
                    "createBrowseHistory"
                ],
                "llm_response_time": 744
            },
            "targetClassMap": {
                "selectByUserIdAndSpuId": {
                    "target_classes": [],
                    "target_classes_sorted_by_llm": [],
                    "llm_response_time": 1584,
                    "similarity_computation_time": 0,
                    "similarity_metric": "cosine"
                },
                "createBrowseHistory": {
                    "target_classes": [],
                    "target_classes_sorted_by_llm": [],
                    "llm_response_time": 1824,
                    "similarity_computation_time": 0,
                    "similarity_metric": "cosine"
                }
            }
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "f361d05940e3e5ac91004fd5e51cad5e34749858",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/f361d05940e3e5ac91004fd5e51cad5e34749858",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public selectByIdAndName(id Long, name String) : CrmBusinessStatusTypeDO extracted from private validateBusinessStatusTypeExists(name String, id Long) : void in class cn.iocoder.yudao.module.crm.service.business.CrmBusinessStatusTypeServiceImpl & moved to class cn.iocoder.yudao.module.crm.dal.mysql.business.CrmBusinessStatusTypeMapper",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/business/CrmBusinessStatusTypeServiceImpl.java",
                    "startLine": 97,
                    "endLine": 106,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "private validateBusinessStatusTypeExists(name String, id Long) : void"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/business/CrmBusinessStatusTypeServiceImpl.java",
                    "startLine": 100,
                    "endLine": 100,
                    "startColumn": 24,
                    "endColumn": 54,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/dal/mysql/business/CrmBusinessStatusTypeMapper.java",
                    "startLine": 32,
                    "endLine": 41,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public selectByIdAndName(id Long, name String) : CrmBusinessStatusTypeDO"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/dal/mysql/business/CrmBusinessStatusTypeMapper.java",
                    "startLine": 40,
                    "endLine": 40,
                    "startColumn": 26,
                    "endColumn": 56,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/business/CrmBusinessStatusTypeServiceImpl.java",
                    "startLine": 97,
                    "endLine": 110,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "private validateBusinessStatusTypeExists(name String, id Long) : void"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/business/CrmBusinessStatusTypeServiceImpl.java",
                    "startLine": 98,
                    "endLine": 98,
                    "startColumn": 56,
                    "endColumn": 108,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "businessStatusTypeMapper.selectByIdAndName(id,name)"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/dal/mysql/business/CrmBusinessStatusTypeMapper.java",
                    "startLine": 40,
                    "endLine": 40,
                    "startColumn": 9,
                    "endColumn": 102,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "added statement in extracted method declaration",
                    "codeElement": null
                }
            ],
            "isStatic": false
        },
        "ref_id": 3,
        "extraction_results": {
            "success": true,
            "newCommitHash": "e2b41dd358c9fc9e7ccf31083e40005c7e49f1bd",
            "newBranchName": "extract-selectByIdAndName-validateBusinessStatusTypeExists-ed34b18"
        },
        "telemetry": {
            "id": "86cb85a0-98a0-4203-ba12-e34851a6e92e",
            "hostFunctionTelemetryData": {
                "hostFunctionSize": 105,
                "lineStart": 29,
                "lineEnd": 133,
                "bodyLineStart": 29,
                "language": "java",
                "filePath": "/Users/abhiram/Documents/TBE/evaluation_projects/ruoyi-vue-pro/yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/business/CrmBusinessStatusTypeServiceImpl.java",
                "sourceCode": "/**\n * \u5546\u673a\u72b6\u6001\u7c7b\u578b Service \u5b9e\u73b0\u7c7b\n *\n * @author ljlleo\n */\n@Service\n@Validated\npublic class CrmBusinessStatusTypeServiceImpl implements CrmBusinessStatusTypeService {\n\n    @Resource\n    private CrmBusinessStatusTypeMapper businessStatusTypeMapper;\n\n    @Resource\n    private CrmBusinessStatusMapper businessStatusMapper;\n\n    @Override\n    @Transactional(rollbackFor = Exception.class)\n    public Long createBusinessStatusType(CrmBusinessStatusTypeSaveReqVO createReqVO) {\n        //\u68c0\u9a8c\u540d\u79f0\u662f\u5426\u5b58\u5728\n        validateBusinessStatusTypeExists(createReqVO.getName(), null);\n        // \u63d2\u5165\u7c7b\u578b\n        CrmBusinessStatusTypeDO businessStatusType = BeanUtils.toBean(createReqVO, CrmBusinessStatusTypeDO.class);\n        businessStatusTypeMapper.insert(businessStatusType);\n        // \u63d2\u5165\u72b6\u6001\n        if (CollUtil.isNotEmpty(createReqVO.getStatusList())) {\n            createReqVO.getStatusList().forEach(status -> status.setTypeId(businessStatusType.getId()));\n            businessStatusMapper.insertBatch(BeanUtils.toBean(createReqVO.getStatusList(), CrmBusinessStatusDO.class));\n        }\n        return businessStatusType.getId();\n    }\n\n    @Override\n    @Transactional(rollbackFor = Exception.class)\n    public void updateBusinessStatusType(CrmBusinessStatusTypeSaveReqVO updateReqVO) {\n        // \u6821\u9a8c\u5b58\u5728\n        validateBusinessStatusTypeExists(updateReqVO.getId());\n        // \u6821\u9a8c\u540d\u79f0\u662f\u5426\u5b58\u5728\n        validateBusinessStatusTypeExists(updateReqVO.getName(), updateReqVO.getId());\n        // \u66f4\u65b0\u7c7b\u578b\n        CrmBusinessStatusTypeDO updateObj = BeanUtils.toBean(updateReqVO, CrmBusinessStatusTypeDO.class);\n        businessStatusTypeMapper.updateById(updateObj);\n        // \u66f4\u65b0\u72b6\u6001\uff08\u5220\u9664 + \u66f4\u65b0\uff09\n        // TODO @ljlleo \u53ef\u4ee5\u53c2\u8003 DeliveryExpressTemplateServiceImpl \u7684 updateExpressTemplateFree \u65b9\u6cd5\uff1b\u4e3b\u8981\u6ca1\u53d8\u5316\u7684\uff0c\u8fd8\u662f\u4e0d\u5220\u9664\u4e86\u54c8\u3002\n        businessStatusMapper.delete(updateReqVO.getId());\n        updateReqVO.getStatusList().forEach(status -> status.setTypeId(updateReqVO.getId()));\n        businessStatusMapper.insertBatch(BeanUtils.toBean(updateReqVO.getStatusList(), CrmBusinessStatusDO.class));\n    }\n\n    @Override\n    @Transactional(rollbackFor = Exception.class)\n    public void deleteBusinessStatusType(Long id) {\n        // TODO \u5f85\u6dfb\u52a0\u88ab\u5f15\u7528\u6821\u9a8c\n        //...\n\n        // \u6821\u9a8c\u5b58\u5728\n        validateBusinessStatusTypeExists(id);\n        // \u5220\u9664\u7c7b\u578b\n        businessStatusTypeMapper.deleteById(id);\n        // \u5220\u9664\u72b6\u6001\n        businessStatusMapper.delete(id);\n    }\n\n    private void validateBusinessStatusTypeExists(Long id) {\n        if (businessStatusTypeMapper.selectById(id) == null) {\n            throw exception(BUSINESS_STATUS_TYPE_NOT_EXISTS);\n        }\n    }\n\n    // TODO @ljlleo \u8fd9\u4e2a\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u53c2\u8003 validateDeptNameUnique \u5b9e\u73b0\u3002\n    private void validateBusinessStatusTypeExists(String name, Long id) {\n        LambdaQueryWrapper<CrmBusinessStatusTypeDO> wrapper = new LambdaQueryWrapperX<>();\n        if(null != id) {\n            wrapper.ne(selectByIdAndName(), id);\n        }\n        long cnt = businessStatusTypeMapper.selectCount(wrapper.eq(CrmBusinessStatusTypeDO::getName, name));\n        if (cnt > 0) {\n            throw exception(BUSINESS_STATUS_TYPE_NAME_EXISTS);\n        }\n    }\n\n    private SFunction<CrmBusinessStatusTypeDO, Object> selectByIdAndName() {\n        return CrmBusinessStatusTypeDO::getId;\n    }\n\n    @Override\n    public CrmBusinessStatusTypeDO getBusinessStatusType(Long id) {\n        return businessStatusTypeMapper.selectById(id);\n    }\n\n    @Override\n    public PageResult<CrmBusinessStatusTypeDO> getBusinessStatusTypePage(CrmBusinessStatusTypePageReqVO pageReqVO) {\n        return businessStatusTypeMapper.selectPage(pageReqVO);\n    }\n\n    @Override\n    public List<CrmBusinessStatusTypeDO> selectList(CrmBusinessStatusTypeQueryVO queryVO) {\n        return businessStatusTypeMapper.selectList(queryVO);\n    }\n\n    @Override\n    public List<CrmBusinessStatusTypeDO> getBusinessStatusTypeList(Collection<Long> ids) {\n        return businessStatusTypeMapper.selectBatchIds(ids);\n    }\n\n}"
            },
            "candidatesTelemetryData": {
                "numberOfSuggestions": 1,
                "candidates": [
                    {
                        "lineStart": 96,
                        "lineEnd": 106,
                        "refactoringType": "MyMoveMethodRefactoring",
                        "refactoringInfo": "Move method validateBusinessStatusTypeExists to class CrmBusinessStatusTypeMapper",
                        "description": "Move method validateBusinessStatusTypeExists to cn.iocoder.yudao.module.crm.dal.mysql.business.CrmBusinessStatusTypeMapper\nRationale: The method validateBusinessStatusTypeExists is directly related to validating the existence of a business status type, which aligns with the responsibilities of the CrmBusinessStatusTypeMapper class that handles operations related to business status types.",
                        "couldCreateRefObject": true,
                        "applied": false,
                        "undone": false
                    }
                ]
            },
            "iterationData": [
                {
                    "iteration_num": 1,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateBusinessStatusTypeExists",
                            "method_signature": "private void validateBusinessStatusTypeExists(Long id)",
                            "target_class": "CrmBusinessStatusTypeValidator",
                            "rationale": "The validation logic for checking if a business status type exists is a separate concern and should be moved to a dedicated validator class to adhere to the Single Responsibility Principle."
                        },
                        {
                            "method_name": "validateBusinessStatusTypeExists",
                            "method_signature": "private void validateBusinessStatusTypeExists(String name, Long id)",
                            "target_class": "CrmBusinessStatusTypeValidator",
                            "rationale": "Similar to the previous method, this validation logic is also a separate concern and should be moved to a dedicated validator class to improve code organization and maintainability."
                        }
                    ],
                    "llm_response_time": 2770
                },
                {
                    "iteration_num": 2,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateBusinessStatusTypeExists",
                            "method_signature": "private void validateBusinessStatusTypeExists(Long id)",
                            "target_class": "CrmBusinessStatusTypeValidator",
                            "rationale": "The validation logic for checking if a business status type exists is a separate concern and should be moved to a dedicated validator class to adhere to the Single Responsibility Principle."
                        },
                        {
                            "method_name": "validateBusinessStatusTypeExists",
                            "method_signature": "private void validateBusinessStatusTypeExists(String name, Long id)",
                            "target_class": "CrmBusinessStatusTypeValidator",
                            "rationale": "Similar to the previous method, this validation logic is also a separate concern and should be moved to a dedicated validator class to improve code organization and maintainability."
                        }
                    ],
                    "llm_response_time": 3143
                },
                {
                    "iteration_num": 3,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateBusinessStatusTypeExists",
                            "method_signature": "private void validateBusinessStatusTypeExists(Long id)",
                            "target_class": "CrmBusinessStatusTypeValidator",
                            "rationale": "The validation logic for checking if a business status type exists is a separate concern and should be moved to a dedicated validator class to adhere to the Single Responsibility Principle."
                        },
                        {
                            "method_name": "validateBusinessStatusTypeExists",
                            "method_signature": "private void validateBusinessStatusTypeExists(String name, Long id)",
                            "target_class": "CrmBusinessStatusTypeValidator",
                            "rationale": "Similar to the previous method, this validation logic is also a separate concern and should be moved to a dedicated validator class to improve code organization and maintainability."
                        }
                    ],
                    "llm_response_time": 2115
                },
                {
                    "iteration_num": -1,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateBusinessStatusTypeExists",
                            "method_signature": "private void validateBusinessStatusTypeExists(Long id)",
                            "target_class": "CrmBusinessStatusTypeValidator",
                            "rationale": "The validation logic for checking if a business status type exists is a separate concern and should be moved to a dedicated validator class to adhere to the Single Responsibility Principle."
                        }
                    ],
                    "llm_response_time": 0
                }
            ],
            "llmMethodPriority": {
                "priority_method_names": [
                    "validateBusinessStatusTypeExists"
                ],
                "llm_response_time": 741
            },
            "targetClassMap": {
                "validateBusinessStatusTypeExists": {
                    "target_classes": [
                        {
                            "class_name": "CrmBusinessStatusTypeMapper",
                            "similarity_score": 0.31214723679042466
                        },
                        {
                            "class_name": "CrmBusinessStatusMapper",
                            "similarity_score": 0.33621471233534644
                        }
                    ],
                    "target_classes_sorted_by_llm": [
                        "CrmBusinessStatusTypeMapper",
                        "CrmBusinessStatusMapper"
                    ],
                    "llm_response_time": 1590,
                    "similarity_computation_time": 2,
                    "similarity_metric": "cosine"
                }
            }
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "6850c7c71d236f73a99658a0af04b98e9bdb2e6b",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/6850c7c71d236f73a99658a0af04b98e9bdb2e6b",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public hasPermission(bizType Integer, bizId Long, userId Long, levelEnum CrmPermissionLevelEnum) : boolean extracted from public deleteFollowUpRecord(id Long, userId Long) : void in class cn.iocoder.yudao.module.crm.service.followup.CrmFollowUpRecordServiceImpl & moved to class cn.iocoder.yudao.module.crm.framework.permission.core.util.CrmPermissionUtils",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/followup/CrmFollowUpRecordServiceImpl.java",
                    "startLine": 119,
                    "endLine": 135,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public deleteFollowUpRecord(id Long, userId Long) : void"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/followup/CrmFollowUpRecordServiceImpl.java",
                    "startLine": 128,
                    "endLine": 128,
                    "startColumn": 17,
                    "endColumn": 143,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/followup/CrmFollowUpRecordServiceImpl.java",
                    "startLine": 125,
                    "endLine": 126,
                    "startColumn": 9,
                    "endColumn": 73,
                    "codeElementType": "VARIABLE_DECLARATION_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/followup/CrmFollowUpRecordServiceImpl.java",
                    "startLine": 127,
                    "endLine": 128,
                    "startColumn": 9,
                    "endColumn": 145,
                    "codeElementType": "VARIABLE_DECLARATION_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/framework/permission/core/util/CrmPermissionUtils.java",
                    "startLine": 33,
                    "endLine": 46,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public hasPermission(bizType Integer, bizId Long, userId Long, levelEnum CrmPermissionLevelEnum) : boolean"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/framework/permission/core/util/CrmPermissionUtils.java",
                    "startLine": 45,
                    "endLine": 45,
                    "startColumn": 17,
                    "endColumn": 124,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/framework/permission/core/util/CrmPermissionUtils.java",
                    "startLine": 43,
                    "endLine": 43,
                    "startColumn": 9,
                    "endColumn": 130,
                    "codeElementType": "VARIABLE_DECLARATION_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/framework/permission/core/util/CrmPermissionUtils.java",
                    "startLine": 44,
                    "endLine": 45,
                    "startColumn": 9,
                    "endColumn": 126,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/followup/CrmFollowUpRecordServiceImpl.java",
                    "startLine": 118,
                    "endLine": 129,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public deleteFollowUpRecord(id Long, userId Long) : void"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/followup/CrmFollowUpRecordServiceImpl.java",
                    "startLine": 123,
                    "endLine": 123,
                    "startColumn": 14,
                    "endColumn": 121,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "hasPermission(followUpRecord.getBizType(),followUpRecord.getBizId(),userId,CrmPermissionLevelEnum.OWNER)"
                }
            ],
            "isStatic": true
        },
        "ref_id": 4,
        "extraction_results": {
            "success": true,
            "newCommitHash": "6cf4a4301d56cfc9d81f437b0290bc854c08795a",
            "newBranchName": "extract-hasPermission-deleteFollowUpRecord-7bb1715"
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "e01dda9bafb906123fb4fdc9c951e5da5c40a53b",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/e01dda9bafb906123fb4fdc9c951e5da5c40a53b",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public selectCountByCategoryId(categoryId Long) : Long extracted from public getProductByCategoryId(categoryId Long) : CrmProductDO in class cn.iocoder.yudao.module.crm.service.product.CrmProductServiceImpl & moved to class cn.iocoder.yudao.module.crm.dal.mysql.product.CrmProductMapper",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/product/CrmProductServiceImpl.java",
                    "startLine": 153,
                    "endLine": 156,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public getProductByCategoryId(categoryId Long) : CrmProductDO"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/product/CrmProductServiceImpl.java",
                    "startLine": 155,
                    "endLine": 155,
                    "startColumn": 82,
                    "endColumn": 109,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/product/CrmProductServiceImpl.java",
                    "startLine": 155,
                    "endLine": 155,
                    "startColumn": 9,
                    "endColumn": 124,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/dal/mysql/product/CrmProductMapper.java",
                    "startLine": 31,
                    "endLine": 33,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public selectCountByCategoryId(categoryId Long) : Long"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/dal/mysql/product/CrmProductMapper.java",
                    "startLine": 32,
                    "endLine": 32,
                    "startColumn": 28,
                    "endColumn": 55,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/dal/mysql/product/CrmProductMapper.java",
                    "startLine": 32,
                    "endLine": 32,
                    "startColumn": 9,
                    "endColumn": 69,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/product/CrmProductServiceImpl.java",
                    "startLine": 146,
                    "endLine": 149,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public getProductByCategoryId(categoryId Long) : Long"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/product/CrmProductServiceImpl.java",
                    "startLine": 148,
                    "endLine": 148,
                    "startColumn": 16,
                    "endColumn": 65,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "productMapper.selectCountByCategoryId(categoryId)"
                }
            ],
            "isStatic": false
        },
        "ref_id": 5,
        "extraction_results": {
            "success": true,
            "newCommitHash": "ad5c0ea90744cad50e17d5e820080e432f0368cf",
            "newBranchName": "extract-selectCountByCategoryId-getProductByCategoryId-7dd35f3"
        },
        "telemetry": {
            "id": "688f00e7-dcab-44e4-af4b-f8f77e284fb6",
            "hostFunctionTelemetryData": {
                "hostFunctionSize": 135,
                "lineStart": 36,
                "lineEnd": 170,
                "bodyLineStart": 36,
                "language": "java",
                "filePath": "/Users/abhiram/Documents/TBE/evaluation_projects/ruoyi-vue-pro/yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/product/CrmProductServiceImpl.java",
                "sourceCode": "/**\n * CRM \u4ea7\u54c1 Service \u5b9e\u73b0\u7c7b\n *\n * @author ZanGe\u4e36\n */\n@Service\n@Validated\npublic class CrmProductServiceImpl implements CrmProductService {\n\n    @Resource(name = \"crmProductMapper\")\n    private CrmProductMapper productMapper;\n\n    @Resource\n    private CrmProductCategoryService productCategoryService;\n    @Resource\n    private CrmPermissionService permissionService;\n\n    @Resource\n    private AdminUserApi adminUserApi;\n\n    @Override\n    @Transactional(rollbackFor = Exception.class)\n    @LogRecord(type = CRM_PRODUCT_TYPE, subType = CRM_PRODUCT_CREATE_SUB_TYPE, bizNo = \"{{#productId}}\",\n            success = CRM_PRODUCT_CREATE_SUCCESS)\n    public Long createProduct(CrmProductSaveReqVO createReqVO) {\n        // 1. \u6821\u9a8c\u4ea7\u54c1\n        adminUserApi.validateUserList(Collections.singleton(createReqVO.getOwnerUserId()));\n        validateProductNoDuplicate(null, createReqVO.getNo());\n        validateProductCategoryExists(createReqVO.getCategoryId());\n\n        // 2. \u63d2\u5165\u4ea7\u54c1\n        CrmProductDO product = BeanUtils.toBean(createReqVO, CrmProductDO.class);\n        productMapper.insert(product);\n\n        // 3. \u63d2\u5165\u6570\u636e\u6743\u9650\n        permissionService.createPermission(new CrmPermissionCreateReqBO().setUserId(product.getOwnerUserId())\n                .setBizType(CrmBizTypeEnum.CRM_PRODUCT.getType()).setBizId(product.getId())\n                .setLevel(CrmPermissionLevelEnum.OWNER.getLevel()));\n\n        // 4. \u8bb0\u5f55\u64cd\u4f5c\u65e5\u5fd7\u4e0a\u4e0b\u6587\n        LogRecordContext.putVariable(\"productId\", product.getId());\n        return product.getId();\n    }\n\n    @Override\n    @LogRecord(type = CRM_PRODUCT_TYPE, subType = CRM_PRODUCT_UPDATE_SUB_TYPE, bizNo = \"{{#updateReqVO.id}}\",\n            success = CRM_PRODUCT_UPDATE_SUCCESS)\n    @CrmPermission(bizType = CrmBizTypeEnum.CRM_PRODUCT, bizId = \"#updateReqVO.id\", level = CrmPermissionLevelEnum.WRITE)\n    public void updateProduct(CrmProductSaveReqVO updateReqVO) {\n        // 1. \u6821\u9a8c\u4ea7\u54c1\n        updateReqVO.setOwnerUserId(null); // \u4e0d\u4fee\u6539\u8d1f\u8d23\u4eba\n        CrmProductDO crmProductDO = validateProductExists(updateReqVO.getId());\n        validateProductNoDuplicate(updateReqVO.getId(), updateReqVO.getNo());\n        validateProductCategoryExists(updateReqVO.getCategoryId());\n\n        // 2. \u66f4\u65b0\u4ea7\u54c1\n        CrmProductDO updateObj = BeanUtils.toBean(updateReqVO, CrmProductDO.class);\n        productMapper.updateById(updateObj);\n\n        // 3. \u8bb0\u5f55\u64cd\u4f5c\u65e5\u5fd7\u4e0a\u4e0b\u6587\n        LogRecordContext.putVariable(DiffParseFunction.OLD_OBJECT, BeanUtils.toBean(crmProductDO, CrmProductSaveReqVO.class));\n    }\n\n    private CrmProductDO validateProductExists(Long id) {\n        CrmProductDO product = productMapper.selectById(id);\n        if (product == null) {\n            throw exception(PRODUCT_NOT_EXISTS);\n        }\n        return product;\n    }\n\n    private void validateProductNoDuplicate(Long id, String no) {\n        CrmProductDO product = productMapper.selectByNo(no);\n        if (product == null\n                || product.getId().equals(id)) {\n            return;\n        }\n        throw exception(PRODUCT_NO_EXISTS);\n    }\n\n    private void validateProductCategoryExists(Long categoryId) {\n        CrmProductCategoryDO category = productCategoryService.getProductCategory(categoryId);\n        if (category == null) {\n            throw exception(PRODUCT_CATEGORY_NOT_EXISTS);\n        }\n    }\n\n    @Override\n    @LogRecord(type = CRM_PRODUCT_TYPE, subType = CRM_PRODUCT_DELETE_SUB_TYPE, bizNo = \"{{#id}}\",\n            success = CRM_PRODUCT_DELETE_SUCCESS)\n    @CrmPermission(bizType = CrmBizTypeEnum.CRM_PRODUCT, bizId = \"#id\", level = CrmPermissionLevelEnum.OWNER)\n    public void deleteProduct(Long id) {\n        // \u6821\u9a8c\u5b58\u5728\n        validateProductExists(id);\n        // \u5220\u9664\n        productMapper.deleteById(id);\n    }\n\n    @Override\n    @CrmPermission(bizType = CrmBizTypeEnum.CRM_PRODUCT, bizId = \"#id\", level = CrmPermissionLevelEnum.READ)\n    public CrmProductDO getProduct(Long id) {\n        return productMapper.selectById(id);\n    }\n\n    @Override\n    public List<CrmProductDO> getProductList(Collection<Long> ids) {\n        if (CollUtil.isEmpty(ids)) {\n            return ListUtil.empty();\n        }\n        return productMapper.selectBatchIds(ids);\n    }\n\n    @Override\n    public PageResult<CrmProductDO> getProductPage(CrmProductPageReqVO pageReqVO, Long userId) {\n        return productMapper.selectPage(pageReqVO, userId);\n    }\n\n    @Override\n    public CrmProductDO getProductByCategoryId(Long categoryId) {\n        return selectCountByCategoryId(categoryId);\n    }\n\n    private CrmProductDO selectCountByCategoryId(Long categoryId) {\n        return productMapper.selectOne(new LambdaQueryWrapper<CrmProductDO>().eq(CrmProductDO::getCategoryId, categoryId));\n    }\n\n    @Override\n    public List<CrmProductDO> getProductListByIds(Collection<Long> ids) {\n        if (CollUtil.isEmpty(ids)) {\n            return Collections.emptyList();\n        }\n        return productMapper.selectBatchIds(ids);\n    }\n\n}"
            },
            "candidatesTelemetryData": {
                "numberOfSuggestions": 4,
                "candidates": [
                    {
                        "lineStart": 98,
                        "lineEnd": 104,
                        "refactoringType": "MyMoveMethodRefactoring",
                        "refactoringInfo": "Move method validateProductExists to class CrmProductMapper",
                        "description": "Move method validateProductExists to cn.iocoder.yudao.module.crm.dal.mysql.product.CrmProductMapper\nRationale: The validateProductExists method directly interacts with the productMapper to check for the existence of a product by its ID, making it a logical fit for the CrmProductMapper class.",
                        "couldCreateRefObject": true,
                        "applied": false,
                        "undone": false
                    },
                    {
                        "lineStart": 106,
                        "lineEnd": 113,
                        "refactoringType": "MyMoveMethodRefactoring",
                        "refactoringInfo": "Move method validateProductNoDuplicate to class CrmProductMapper",
                        "description": "Move method validateProductNoDuplicate to cn.iocoder.yudao.module.crm.dal.mysql.product.CrmProductMapper\nRationale: The method validateProductNoDuplicate() interacts directly with product data by querying the database for a product based on its number. It is logical to place this method in CrmProductMapper, which is responsible for data access related to products.",
                        "couldCreateRefObject": true,
                        "applied": false,
                        "undone": false
                    },
                    {
                        "lineStart": 115,
                        "lineEnd": 120,
                        "refactoringType": "MyMoveMethodRefactoring",
                        "refactoringInfo": "Move method validateProductCategoryExists to class CrmProductCategoryService",
                        "description": "Move method validateProductCategoryExists to cn.iocoder.yudao.module.crm.service.product.CrmProductCategoryService\nRationale: The method validateProductCategoryExists is directly related to validating the existence of a product category, which aligns with the responsibilities of the CrmProductCategoryService class.",
                        "couldCreateRefObject": true,
                        "applied": false,
                        "undone": false
                    },
                    {
                        "lineStart": 157,
                        "lineEnd": 159,
                        "refactoringType": "MyMoveMethodRefactoring",
                        "refactoringInfo": "Move method selectCountByCategoryId to class CrmProductMapper",
                        "description": "Move method selectCountByCategoryId to cn.iocoder.yudao.module.crm.dal.mysql.product.CrmProductMapper\nRationale: The method selectCountByCategoryId directly interacts with the productMapper to query products based on categoryId, making it a logical fit for the CrmProductMapper class, which is responsible for data access related to CrmProductDO.",
                        "couldCreateRefObject": true,
                        "applied": false,
                        "undone": false
                    }
                ]
            },
            "iterationData": [
                {
                    "iteration_num": 1,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateProductExists",
                            "method_signature": "private CrmProductDO validateProductExists(Long id)",
                            "target_class": "CrmProductValidator",
                            "rationale": "This method is responsible for validating the existence of a product, which is a validation concern. Moving it to a dedicated validator class will separate validation logic from service logic."
                        },
                        {
                            "method_name": "validateProductNoDuplicate",
                            "method_signature": "private void validateProductNoDuplicate(Long id, String no)",
                            "target_class": "CrmProductValidator",
                            "rationale": "This method checks for duplicate product numbers, which is also a validation concern. It should be moved to a dedicated validator class to maintain separation of concerns."
                        },
                        {
                            "method_name": "validateProductCategoryExists",
                            "method_signature": "private void validateProductCategoryExists(Long categoryId)",
                            "target_class": "CrmProductValidator",
                            "rationale": "This method validates the existence of a product category, which is a validation concern. Moving it to a dedicated validator class will help keep the service class focused on business logic."
                        },
                        {
                            "method_name": "selectCountByCategoryId",
                            "method_signature": "private CrmProductDO selectCountByCategoryId(Long categoryId)",
                            "target_class": "CrmProductRepository",
                            "rationale": "This method is primarily concerned with data retrieval based on category ID. Moving it to a repository class will better align it with data access responsibilities."
                        }
                    ],
                    "llm_response_time": 5514
                },
                {
                    "iteration_num": 2,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateProductExists",
                            "method_signature": "private CrmProductDO validateProductExists(Long id)",
                            "target_class": "CrmProductValidator",
                            "rationale": "This method is responsible for validating the existence of a product, which is a validation concern. Moving it to a dedicated validator class will separate validation logic from service logic, adhering to the Single Responsibility Principle."
                        },
                        {
                            "method_name": "validateProductNoDuplicate",
                            "method_signature": "private void validateProductNoDuplicate(Long id, String no)",
                            "target_class": "CrmProductValidator",
                            "rationale": "This method checks for duplicate product numbers, which is also a validation concern. It should be moved to a dedicated validator class to keep the service class focused on business logic."
                        },
                        {
                            "method_name": "validateProductCategoryExists",
                            "method_signature": "private void validateProductCategoryExists(Long categoryId)",
                            "target_class": "CrmProductValidator",
                            "rationale": "This method validates the existence of a product category, which is part of the validation logic. Moving it to a dedicated validator class will improve code organization and maintainability."
                        },
                        {
                            "method_name": "selectCountByCategoryId",
                            "method_signature": "private CrmProductDO selectCountByCategoryId(Long categoryId)",
                            "target_class": "CrmProductRepository",
                            "rationale": "This method is primarily concerned with data retrieval based on category ID. Moving it to a repository class will better align it with data access responsibilities."
                        }
                    ],
                    "llm_response_time": 4301
                },
                {
                    "iteration_num": 3,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateProductExists",
                            "method_signature": "private CrmProductDO validateProductExists(Long id)",
                            "target_class": "CrmProductValidator",
                            "rationale": "This method is responsible for validating the existence of a product, which is a validation concern. Moving it to a dedicated validator class will separate validation logic from service logic."
                        },
                        {
                            "method_name": "validateProductNoDuplicate",
                            "method_signature": "private void validateProductNoDuplicate(Long id, String no)",
                            "target_class": "CrmProductValidator",
                            "rationale": "This method checks for duplicate product numbers, which is also a validation concern. It should be moved to a dedicated validator class to maintain separation of concerns."
                        },
                        {
                            "method_name": "validateProductCategoryExists",
                            "method_signature": "private void validateProductCategoryExists(Long categoryId)",
                            "target_class": "CrmProductValidator",
                            "rationale": "This method validates the existence of a product category, which is a validation concern. Moving it to a dedicated validator class will help keep the service class focused on business logic."
                        },
                        {
                            "method_name": "selectCountByCategoryId",
                            "method_signature": "private CrmProductDO selectCountByCategoryId(Long categoryId)",
                            "target_class": "CrmProductRepository",
                            "rationale": "This method is primarily concerned with data retrieval based on category ID. Moving it to a repository class will better align it with data access responsibilities."
                        }
                    ],
                    "llm_response_time": 3756
                },
                {
                    "iteration_num": -1,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateProductExists",
                            "method_signature": "private CrmProductDO validateProductExists(Long id)",
                            "target_class": "CrmProductValidator",
                            "rationale": "This method is responsible for validating the existence of a product, which is a validation concern. Moving it to a dedicated validator class will separate validation logic from service logic."
                        },
                        {
                            "method_name": "validateProductNoDuplicate",
                            "method_signature": "private void validateProductNoDuplicate(Long id, String no)",
                            "target_class": "CrmProductValidator",
                            "rationale": "This method checks for duplicate product numbers, which is also a validation concern. It should be moved to a dedicated validator class to maintain separation of concerns."
                        },
                        {
                            "method_name": "validateProductCategoryExists",
                            "method_signature": "private void validateProductCategoryExists(Long categoryId)",
                            "target_class": "CrmProductValidator",
                            "rationale": "This method validates the existence of a product category, which is a validation concern. Moving it to a dedicated validator class will help keep the service class focused on business logic."
                        },
                        {
                            "method_name": "selectCountByCategoryId",
                            "method_signature": "private CrmProductDO selectCountByCategoryId(Long categoryId)",
                            "target_class": "CrmProductRepository",
                            "rationale": "This method is primarily concerned with data retrieval based on category ID. Moving it to a repository class will better align it with data access responsibilities."
                        }
                    ],
                    "llm_response_time": 0
                }
            ],
            "llmMethodPriority": {
                "priority_method_names": [
                    "validateProductExists",
                    "validateProductNoDuplicate",
                    "validateProductCategoryExists",
                    "selectCountByCategoryId"
                ],
                "llm_response_time": 665
            },
            "targetClassMap": {
                "validateProductExists": {
                    "target_classes": [
                        {
                            "class_name": "CrmProductMapper",
                            "similarity_score": 0.363766418634276
                        },
                        {
                            "class_name": "CrmProductCategoryService",
                            "similarity_score": 0.0269069117598525
                        },
                        {
                            "class_name": "CrmPermissionService",
                            "similarity_score": 0.011526276724721124
                        },
                        {
                            "class_name": "AdminUserApi",
                            "similarity_score": 0.06871053855870159
                        }
                    ],
                    "target_classes_sorted_by_llm": [
                        "CrmProductMapper",
                        "CrmProductCategoryService",
                        "AdminUserApi",
                        "CrmPermissionService"
                    ],
                    "llm_response_time": 2621,
                    "similarity_computation_time": 2,
                    "similarity_metric": "cosine"
                },
                "validateProductNoDuplicate": {
                    "target_classes": [
                        {
                            "class_name": "CrmProductMapper",
                            "similarity_score": 0.314970394174356
                        },
                        {
                            "class_name": "CrmProductCategoryService",
                            "similarity_score": 0.03960590171906697
                        },
                        {
                            "class_name": "CrmPermissionService",
                            "similarity_score": 0.033932439903952505
                        },
                        {
                            "class_name": "AdminUserApi",
                            "similarity_score": 0.06742611617189456
                        }
                    ],
                    "target_classes_sorted_by_llm": [
                        "CrmProductMapper",
                        "CrmProductCategoryService",
                        "AdminUserApi",
                        "CrmPermissionService"
                    ],
                    "llm_response_time": 2807,
                    "similarity_computation_time": 1,
                    "similarity_metric": "cosine"
                },
                "validateProductCategoryExists": {
                    "target_classes": [
                        {
                            "class_name": "CrmProductMapper",
                            "similarity_score": 0.30240736837950305
                        },
                        {
                            "class_name": "CrmProductCategoryService",
                            "similarity_score": 0.05118906968889914
                        },
                        {
                            "class_name": "CrmPermissionService",
                            "similarity_score": 0.03445855561783899
                        },
                        {
                            "class_name": "AdminUserApi",
                            "similarity_score": 0.07469623053489781
                        }
                    ],
                    "target_classes_sorted_by_llm": [
                        "CrmProductCategoryService",
                        "CrmProductMapper",
                        "AdminUserApi",
                        "CrmPermissionService"
                    ],
                    "llm_response_time": 2214,
                    "similarity_computation_time": 1,
                    "similarity_metric": "cosine"
                },
                "selectCountByCategoryId": {
                    "target_classes": [
                        {
                            "class_name": "CrmProductMapper",
                            "similarity_score": 0.3105295017040594
                        },
                        {
                            "class_name": "CrmProductCategoryService",
                            "similarity_score": 0.021693045781865615
                        },
                        {
                            "class_name": "CrmPermissionService",
                            "similarity_score": 0.00929278138329161
                        },
                        {
                            "class_name": "AdminUserApi",
                            "similarity_score": 0.05170312670923474
                        }
                    ],
                    "target_classes_sorted_by_llm": [
                        "CrmProductMapper",
                        "CrmProductCategoryService",
                        "AdminUserApi",
                        "CrmPermissionService"
                    ],
                    "llm_response_time": 5970,
                    "similarity_computation_time": 1,
                    "similarity_metric": "cosine"
                }
            }
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "be2431b73b48bbf040d86039106a3af536a3e805",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/be2431b73b48bbf040d86039106a3af536a3e805",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public convertBpmResultToAuditStatus(bpmResult Integer) : Integer extracted from public updateContractAuditStatus(id Long, bpmResult Integer) : void in class cn.iocoder.yudao.module.crm.service.contract.CrmContractServiceImpl & moved to class cn.iocoder.yudao.module.crm.util.CrmAuditStatusUtils",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/contract/CrmContractServiceImpl.java",
                    "startLine": 294,
                    "endLine": 311,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public updateContractAuditStatus(id Long, bpmResult Integer) : void"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/contract/CrmContractServiceImpl.java",
                    "startLine": 306,
                    "endLine": 308,
                    "startColumn": 9,
                    "endColumn": 67,
                    "codeElementType": "VARIABLE_DECLARATION_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/contract/CrmContractServiceImpl.java",
                    "startLine": 309,
                    "endLine": 309,
                    "startColumn": 9,
                    "endColumn": 69,
                    "codeElementType": "EXPRESSION_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/util/CrmAuditStatusUtils.java",
                    "startLine": 15,
                    "endLine": 27,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public convertBpmResultToAuditStatus(bpmResult Integer) : Integer"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/util/CrmAuditStatusUtils.java",
                    "startLine": 22,
                    "endLine": 24,
                    "startColumn": 9,
                    "endColumn": 67,
                    "codeElementType": "VARIABLE_DECLARATION_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/util/CrmAuditStatusUtils.java",
                    "startLine": 25,
                    "endLine": 25,
                    "startColumn": 9,
                    "endColumn": 69,
                    "codeElementType": "EXPRESSION_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/contract/CrmContractServiceImpl.java",
                    "startLine": 294,
                    "endLine": 308,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public updateContractAuditStatus(id Long, bpmResult Integer) : void"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/contract/CrmContractServiceImpl.java",
                    "startLine": 306,
                    "endLine": 306,
                    "startColumn": 31,
                    "endColumn": 71,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "convertBpmResultToAuditStatus(bpmResult)"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/util/CrmAuditStatusUtils.java",
                    "startLine": 21,
                    "endLine": 21,
                    "startColumn": 9,
                    "endColumn": 91,
                    "codeElementType": "EXPRESSION_STATEMENT",
                    "description": "added statement in extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/util/CrmAuditStatusUtils.java",
                    "startLine": 26,
                    "endLine": 26,
                    "startColumn": 9,
                    "endColumn": 28,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "added statement in extracted method declaration",
                    "codeElement": null
                }
            ],
            "isStatic": true
        },
        "ref_id": 6,
        "extraction_results": {
            "success": true,
            "newCommitHash": "201149bb5c4eb2895601f7f262b623562477b278",
            "newBranchName": "extract-convertBpmResultToAuditStatus-updateContractAuditStatus-eddd0a8"
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "29f1eb2c184bf7485734d8f869a236bab337fe25",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/29f1eb2c184bf7485734d8f869a236bab337fe25",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public getBusinessMap(ids Collection<Long>) : Map<Long,CrmBusinessDO> extracted from private buildContractDetailList(contractList List<CrmContractDO>) : List<CrmContractRespVO> in class cn.iocoder.yudao.module.crm.controller.admin.contract.CrmContractController & moved to class cn.iocoder.yudao.module.crm.service.business.CrmBusinessService",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/contract/CrmContractController.java",
                    "startLine": 169,
                    "endLine": 208,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "private buildContractDetailList(contractList List<CrmContractDO>) : List<CrmContractRespVO>"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/contract/CrmContractController.java",
                    "startLine": 191,
                    "endLine": 191,
                    "startColumn": 49,
                    "endColumn": 69,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/contract/CrmContractController.java",
                    "startLine": 190,
                    "endLine": 191,
                    "startColumn": 9,
                    "endColumn": 71,
                    "codeElementType": "VARIABLE_DECLARATION_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/business/CrmBusinessService.java",
                    "startLine": 109,
                    "endLine": 117,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public getBusinessMap(ids Collection<Long>) : Map<Long,CrmBusinessDO>"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/business/CrmBusinessService.java",
                    "startLine": 116,
                    "endLine": 116,
                    "startColumn": 49,
                    "endColumn": 69,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/business/CrmBusinessService.java",
                    "startLine": 116,
                    "endLine": 116,
                    "startColumn": 9,
                    "endColumn": 71,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/contract/CrmContractController.java",
                    "startLine": 169,
                    "endLine": 208,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "private buildContractDetailList(contractList List<CrmContractDO>) : List<CrmContractRespVO>"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/contract/CrmContractController.java",
                    "startLine": 190,
                    "endLine": 191,
                    "startColumn": 48,
                    "endColumn": 72,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "businessService.getBusinessMap(convertSet(contractList,CrmContractDO::getBusinessId))"
                }
            ],
            "isStatic": false
        },
        "ref_id": 7,
        "extraction_results": {
            "success": true,
            "newCommitHash": "20b6f4ee8e05341157c97624725a5dedc7d574dc",
            "newBranchName": "extract-getBusinessMap-buildContractDetailList-3f8fa6b"
        },
        "telemetry": {
            "id": "6cbf9de2-7c53-4fe8-bf2c-7cee7de09e52",
            "hostFunctionTelemetryData": {
                "hostFunctionSize": 176,
                "lineStart": 54,
                "lineEnd": 229,
                "bodyLineStart": 54,
                "language": "java",
                "filePath": "/Users/abhiram/Documents/TBE/evaluation_projects/ruoyi-vue-pro/yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/contract/CrmContractController.java",
                "sourceCode": "@Tag(name = \"\u7ba1\u7406\u540e\u53f0 - CRM \u5408\u540c\")\n@RestController\n@RequestMapping(\"/crm/contract\")\n@Validated\npublic class CrmContractController {\n\n    @Resource\n    private CrmContractService contractService;\n    @Resource\n    private CrmCustomerService customerService;\n    @Resource\n    private CrmContactService contactService;\n    @Resource\n    private CrmBusinessService businessService;\n    @Resource\n    private CrmProductService productService;\n\n    @Resource\n    private AdminUserApi adminUserApi;\n    @Resource\n    private DeptApi deptApi;\n\n    @PostMapping(\"/create\")\n    @Operation(summary = \"\u521b\u5efa\u5408\u540c\")\n    @PreAuthorize(\"@ss.hasPermission('crm:contract:create')\")\n    public CommonResult<Long> createContract(@Valid @RequestBody CrmContractSaveReqVO createReqVO) {\n        return success(contractService.createContract(createReqVO, getLoginUserId()));\n    }\n\n    @PutMapping(\"/update\")\n    @Operation(summary = \"\u66f4\u65b0\u5408\u540c\")\n    @PreAuthorize(\"@ss.hasPermission('crm:contract:update')\")\n    public CommonResult<Boolean> updateContract(@Valid @RequestBody CrmContractSaveReqVO updateReqVO) {\n        contractService.updateContract(updateReqVO);\n        return success(true);\n    }\n\n    @DeleteMapping(\"/delete\")\n    @Operation(summary = \"\u5220\u9664\u5408\u540c\")\n    @Parameter(name = \"id\", description = \"\u7f16\u53f7\", required = true)\n    @PreAuthorize(\"@ss.hasPermission('crm:contract:delete')\")\n    public CommonResult<Boolean> deleteContract(@RequestParam(\"id\") Long id) {\n        contractService.deleteContract(id);\n        return success(true);\n    }\n\n    @GetMapping(\"/get\")\n    @Operation(summary = \"\u83b7\u5f97\u5408\u540c\")\n    @Parameter(name = \"id\", description = \"\u7f16\u53f7\", required = true, example = \"1024\")\n    @PreAuthorize(\"@ss.hasPermission('crm:contract:query')\")\n    public CommonResult<CrmContractRespVO> getContract(@RequestParam(\"id\") Long id) {\n        CrmContractDO contract = contractService.getContract(id);\n        return success(buildContractDetail(contract));\n    }\n\n    private CrmContractRespVO buildContractDetail(CrmContractDO contract) {\n        if (contract == null) {\n            return null;\n        }\n        CrmContractRespVO contractVO = buildContractDetailList(singletonList(contract)).get(0);\n        // \u62fc\u63a5\u4ea7\u54c1\u9879\n        List<CrmContractProductDO> businessProducts = contractService.getContractProductListByContractId(contractVO.getId());\n        Map<Long, CrmProductDO> productMap = productService.getProductMap(\n                convertSet(businessProducts, CrmContractProductDO::getProductId));\n        contractVO.setProducts(BeanUtils.toBean(businessProducts, CrmContractRespVO.Product.class, businessProductVO ->\n                MapUtils.findAndThen(productMap, businessProductVO.getProductId(),\n                        product -> businessProductVO.setProductName(product.getName())\n                                .setProductNo(product.getNo()).setProductUnit(product.getUnit()))));\n        return contractVO;\n    }\n\n    @GetMapping(\"/page\")\n    @Operation(summary = \"\u83b7\u5f97\u5408\u540c\u5206\u9875\")\n    @PreAuthorize(\"@ss.hasPermission('crm:contract:query')\")\n    public CommonResult<PageResult<CrmContractRespVO>> getContractPage(@Valid CrmContractPageReqVO pageVO) {\n        PageResult<CrmContractDO> pageResult = contractService.getContractPage(pageVO, getLoginUserId());\n        return success(BeanUtils.toBean(pageResult, CrmContractRespVO.class).setList(buildContractDetailList(pageResult.getList())));\n    }\n\n    @GetMapping(\"/page-by-customer\")\n    @Operation(summary = \"\u83b7\u5f97\u5408\u540c\u5206\u9875\uff0c\u57fa\u4e8e\u6307\u5b9a\u5ba2\u6237\")\n    public CommonResult<PageResult<CrmContractRespVO>> getContractPageByCustomer(@Valid CrmContractPageReqVO pageVO) {\n        Assert.notNull(pageVO.getCustomerId(), \"\u5ba2\u6237\u7f16\u53f7\u4e0d\u80fd\u4e3a\u7a7a\");\n        PageResult<CrmContractDO> pageResult = contractService.getContractPageByCustomerId(pageVO);\n        return success(BeanUtils.toBean(pageResult, CrmContractRespVO.class).setList(buildContractDetailList(pageResult.getList())));\n    }\n\n    @GetMapping(\"/export-excel\")\n    @Operation(summary = \"\u5bfc\u51fa\u5408\u540c Excel\")\n    @PreAuthorize(\"@ss.hasPermission('crm:contract:export')\")\n    @OperateLog(type = EXPORT)\n    public void exportContractExcel(@Valid CrmContractPageReqVO exportReqVO,\n                                    HttpServletResponse response) throws IOException {\n        PageResult<CrmContractDO> pageResult = contractService.getContractPage(exportReqVO, getLoginUserId());\n        // \u5bfc\u51fa Excel\n        ExcelUtils.write(response, \"\u5408\u540c.xls\", \"\u6570\u636e\", CrmContractRespVO.class,\n                BeanUtils.toBean(pageResult.getList(), CrmContractRespVO.class));\n    }\n\n    @PutMapping(\"/transfer\")\n    @Operation(summary = \"\u5408\u540c\u8f6c\u79fb\")\n    @PreAuthorize(\"@ss.hasPermission('crm:contract:update')\")\n    public CommonResult<Boolean> transferContract(@Valid @RequestBody CrmContractTransferReqVO reqVO) {\n        contractService.transferContract(reqVO, getLoginUserId());\n        return success(true);\n    }\n\n    @PutMapping(\"/submit\")\n    @Operation(summary = \"\u63d0\u4ea4\u5408\u540c\u5ba1\u6279\")\n    @PreAuthorize(\"@ss.hasPermission('crm:contract:update')\")\n    public CommonResult<Boolean> submitContract(@RequestParam(\"id\") Long id) {\n        contractService.submitContract(id, getLoginUserId());\n        return success(true);\n    }\n\n    /**\n     * \u6784\u5efa\u8be6\u7ec6\u7684\u5408\u540c\u7ed3\u679c\n     *\n     * @param contractList \u539f\u59cb\u5408\u540c\u4fe1\u606f\n     * @return \u7ec6\u7684\u5408\u540c\u7ed3\u679c\n     */\n    private List<CrmContractRespVO> buildContractDetailList(List<CrmContractDO> contractList) {\n        if (CollUtil.isEmpty(contractList)) {\n            return Collections.emptyList();\n        }\n        // 1.1 \u83b7\u53d6\u5ba2\u6237\u5217\u8868\n        Map<Long, CrmCustomerDO> customerMap = customerService.getCustomerMap(\n                convertSet(contractList, CrmContractDO::getCustomerId));\n        // 1.2 \u83b7\u53d6\u521b\u5efa\u4eba\u3001\u8d1f\u8d23\u4eba\u5217\u8868\n        Map<Long, AdminUserRespDTO> userMap = adminUserApi.getUserMap(convertListByFlatMap(contractList,\n                contact -> Stream.of(NumberUtils.parseLong(contact.getCreator()), contact.getOwnerUserId())));\n        Map<Long, DeptRespDTO> deptMap = deptApi.getDeptMap(convertSet(userMap.values(), AdminUserRespDTO::getDeptId));\n        // 1.3 \u83b7\u53d6\u8054\u7cfb\u4eba\n        Map<Long, CrmContactDO> contactMap = convertMap(contactService.getContactList(convertSet(contractList,\n                CrmContractDO::getSignContactId)), CrmContactDO::getId);\n        // 1.4 \u83b7\u53d6\u5546\u673a\n        Map<Long, CrmBusinessDO> businessMap = getBusinessMap(contractList);\n        // 2. \u62fc\u63a5\u6570\u636e\n        return BeanUtils.toBean(contractList, CrmContractRespVO.class, contractVO -> {\n            // 2.1 \u8bbe\u7f6e\u5ba2\u6237\u4fe1\u606f\n            findAndThen(customerMap, contractVO.getCustomerId(), customer -> contractVO.setCustomerName(customer.getName()));\n            // 2.2 \u8bbe\u7f6e\u7528\u6237\u4fe1\u606f\n            findAndThen(userMap, Long.parseLong(contractVO.getCreator()), user -> contractVO.setCreatorName(user.getNickname()));\n            MapUtils.findAndThen(userMap, contractVO.getOwnerUserId(), user -> {\n                contractVO.setOwnerUserName(user.getNickname());\n                MapUtils.findAndThen(deptMap, user.getDeptId(), dept -> contractVO.setOwnerUserDeptName(dept.getName()));\n            });\n            findAndThen(userMap, contractVO.getSignUserId(), user -> contractVO.setSignUserName(user.getNickname()));\n            // 2.3 \u8bbe\u7f6e\u8054\u7cfb\u4eba\u4fe1\u606f\n            findAndThen(contactMap, contractVO.getSignContactId(), contact -> contractVO.setSignContactName(contact.getName()));\n            // 2.4 \u8bbe\u7f6e\u5546\u673a\u4fe1\u606f\n            findAndThen(businessMap, contractVO.getBusinessId(), business -> contractVO.setBusinessName(business.getName()));\n        });\n    }\n\n    private Map<Long, CrmBusinessDO> getBusinessMap(List<CrmContractDO> contractList) {\n        Map<Long, CrmBusinessDO> businessMap = convertMap(businessService.getBusinessList(convertSet(contractList,\n                CrmContractDO::getBusinessId)), CrmBusinessDO::getId);\n        return businessMap;\n    }\n\n    @GetMapping(\"/check-contract-count\")\n    @Operation(summary = \"\u83b7\u5f97\u5f85\u5ba1\u6838\u5408\u540c\u6570\u91cf\")\n    @PreAuthorize(\"@ss.hasPermission('crm:contract:query')\")\n    public CommonResult<Long> getCheckContractCount() {\n        return success(contractService.getCheckContractCount(getLoginUserId()));\n    }\n\n    @GetMapping(\"/end-contract-count\")\n    @Operation(summary = \"\u83b7\u5f97\u5373\u5c06\u5230\u671f\u7684\u5408\u540c\u6570\u91cf\")\n    @PreAuthorize(\"@ss.hasPermission('crm:contract:query')\")\n    public CommonResult<Long> getEndContractCount() {\n        return success(contractService.getEndContractCount(getLoginUserId()));\n    }\n\n}"
            },
            "candidatesTelemetryData": {
                "numberOfSuggestions": 3,
                "candidates": [
                    {
                        "lineStart": 168,
                        "lineEnd": 206,
                        "refactoringType": "MyMoveMethodRefactoring",
                        "refactoringInfo": "Move method buildContractDetailList to class CrmCustomerService",
                        "description": "Move method buildContractDetailList to cn.iocoder.yudao.module.crm.service.customer.CrmCustomerService\nRationale: The method buildContractDetailList is primarily focused on constructing detailed contract results, which involves retrieving customer information and mapping it to contract data. This aligns closely with the responsibilities of the CrmCustomerService class.",
                        "couldCreateRefObject": true,
                        "applied": false,
                        "undone": false
                    },
                    {
                        "lineStart": 108,
                        "lineEnd": 122,
                        "refactoringType": "MyMoveMethodRefactoring",
                        "refactoringInfo": "Move method buildContractDetail to class CrmBusinessService",
                        "description": "Move method buildContractDetail to cn.iocoder.yudao.module.crm.service.business.CrmBusinessService\nRationale: The method buildContractDetail is responsible for constructing a contract response object, which is closely related to business logic involving contracts. Moving it to CrmBusinessService aligns it with the service layer that handles business operations related to contracts.",
                        "couldCreateRefObject": true,
                        "applied": false,
                        "undone": false
                    },
                    {
                        "lineStart": 208,
                        "lineEnd": 212,
                        "refactoringType": "MyMoveMethodRefactoring",
                        "refactoringInfo": "Move method getBusinessMap to class CrmBusinessService",
                        "description": "Move method getBusinessMap to cn.iocoder.yudao.module.crm.service.business.CrmBusinessService\nRationale: The method is focused on retrieving and converting business data related to contracts, which aligns with the responsibilities of the CrmBusinessService class.",
                        "couldCreateRefObject": true,
                        "applied": false,
                        "undone": false
                    }
                ]
            },
            "iterationData": [
                {
                    "iteration_num": 1,
                    "suggested_move_methods": [
                        {
                            "method_name": "buildContractDetail",
                            "method_signature": "private CrmContractRespVO buildContractDetail(CrmContractDO contract)",
                            "target_class": "CrmContractService",
                            "rationale": "The method buildContractDetail is primarily concerned with constructing a detailed representation of a contract, which aligns more closely with the responsibilities of the CrmContractService class."
                        },
                        {
                            "method_name": "buildContractDetailList",
                            "method_signature": "private List<CrmContractRespVO> buildContractDetailList(List<CrmContractDO> contractList)",
                            "target_class": "CrmContractService",
                            "rationale": "The method buildContractDetailList is responsible for transforming a list of contract data into a list of response objects, which is a service-level operation that should be handled by the CrmContractService."
                        },
                        {
                            "method_name": "getBusinessMap",
                            "method_signature": "private Map<Long, CrmBusinessDO> getBusinessMap(List<CrmContractDO> contractList)",
                            "target_class": "CrmBusinessService",
                            "rationale": "The method getBusinessMap retrieves business data related to contracts, which is more appropriately handled by the CrmBusinessService, as it deals with business entities."
                        }
                    ],
                    "llm_response_time": 4758
                },
                {
                    "iteration_num": 2,
                    "suggested_move_methods": [
                        {
                            "method_name": "buildContractDetail",
                            "method_signature": "private CrmContractRespVO buildContractDetail(CrmContractDO contract)",
                            "target_class": "CrmContractService",
                            "rationale": "The method buildContractDetail is primarily concerned with constructing a detailed representation of a contract, which aligns more closely with the responsibilities of the CrmContractService class."
                        },
                        {
                            "method_name": "buildContractDetailList",
                            "method_signature": "private List<CrmContractRespVO> buildContractDetailList(List<CrmContractDO> contractList)",
                            "target_class": "CrmContractService",
                            "rationale": "The method buildContractDetailList is responsible for transforming a list of contract data into a list of response objects, which is a service-level operation that should be handled by the CrmContractService."
                        },
                        {
                            "method_name": "getBusinessMap",
                            "method_signature": "private Map<Long, CrmBusinessDO> getBusinessMap(List<CrmContractDO> contractList)",
                            "target_class": "CrmBusinessService",
                            "rationale": "The method getBusinessMap retrieves business data related to contracts, which is more appropriately handled by the CrmBusinessService, as it deals with business entities."
                        }
                    ],
                    "llm_response_time": 4294
                },
                {
                    "iteration_num": 3,
                    "suggested_move_methods": [
                        {
                            "method_name": "buildContractDetail",
                            "method_signature": "private CrmContractRespVO buildContractDetail(CrmContractDO contract)",
                            "target_class": "CrmContractService",
                            "rationale": "The method buildContractDetail is responsible for constructing a detailed contract response, which is a service-level operation. It should be moved to CrmContractService to adhere to the single responsibility principle."
                        },
                        {
                            "method_name": "buildContractDetailList",
                            "method_signature": "private List<CrmContractRespVO> buildContractDetailList(List<CrmContractDO> contractList)",
                            "target_class": "CrmContractService",
                            "rationale": "Similar to buildContractDetail, this method is focused on transforming contract data into a response format, which aligns with the responsibilities of the CrmContractService."
                        },
                        {
                            "method_name": "getBusinessMap",
                            "method_signature": "private Map<Long, CrmBusinessDO> getBusinessMap(List<CrmContractDO> contractList)",
                            "target_class": "CrmBusinessService",
                            "rationale": "The getBusinessMap method retrieves business data related to contracts, which is a responsibility that fits better within the CrmBusinessService."
                        }
                    ],
                    "llm_response_time": 3372
                },
                {
                    "iteration_num": -1,
                    "suggested_move_methods": [
                        {
                            "method_name": "buildContractDetail",
                            "method_signature": "private CrmContractRespVO buildContractDetail(CrmContractDO contract)",
                            "target_class": "CrmContractService",
                            "rationale": "The method buildContractDetail is primarily concerned with constructing a detailed representation of a contract, which aligns more closely with the responsibilities of the CrmContractService class."
                        },
                        {
                            "method_name": "buildContractDetailList",
                            "method_signature": "private List<CrmContractRespVO> buildContractDetailList(List<CrmContractDO> contractList)",
                            "target_class": "CrmContractService",
                            "rationale": "The method buildContractDetailList is responsible for transforming a list of contract data into a list of response objects, which is a service-level operation that should be handled by the CrmContractService."
                        },
                        {
                            "method_name": "getBusinessMap",
                            "method_signature": "private Map<Long, CrmBusinessDO> getBusinessMap(List<CrmContractDO> contractList)",
                            "target_class": "CrmBusinessService",
                            "rationale": "The method getBusinessMap retrieves business data related to contracts, which is more appropriately handled by the CrmBusinessService, as it deals with business entities."
                        }
                    ],
                    "llm_response_time": 0
                }
            ],
            "llmMethodPriority": {
                "priority_method_names": [
                    "buildContractDetailList",
                    "buildContractDetail",
                    "getBusinessMap"
                ],
                "llm_response_time": 730
            },
            "targetClassMap": {
                "buildContractDetailList": {
                    "target_classes": [
                        {
                            "class_name": "CrmContractService",
                            "similarity_score": 0.23301022143222372
                        },
                        {
                            "class_name": "CrmCustomerService",
                            "similarity_score": 0.2420995118795252
                        },
                        {
                            "class_name": "CrmContactService",
                            "similarity_score": 0.24109159625275
                        },
                        {
                            "class_name": "CrmBusinessService",
                            "similarity_score": 0.24385953851832048
                        },
                        {
                            "class_name": "CrmProductService",
                            "similarity_score": 0.25038941998643466
                        },
                        {
                            "class_name": "AdminUserApi",
                            "similarity_score": 0.2647957548245656
                        },
                        {
                            "class_name": "DeptApi",
                            "similarity_score": 0.2725218844899761
                        }
                    ],
                    "target_classes_sorted_by_llm": [
                        "CrmCustomerService",
                        "AdminUserApi",
                        "CrmBusinessService",
                        "DeptApi",
                        "CrmProductService"
                    ],
                    "llm_response_time": 2860,
                    "similarity_computation_time": 6,
                    "similarity_metric": "cosine"
                },
                "buildContractDetail": {
                    "target_classes": [
                        {
                            "class_name": "CrmContractService",
                            "similarity_score": 0.007479651240011828
                        },
                        {
                            "class_name": "CrmCustomerService",
                            "similarity_score": 0.014897662376526026
                        },
                        {
                            "class_name": "CrmContactService",
                            "similarity_score": 0.01589922448693569
                        },
                        {
                            "class_name": "CrmBusinessService",
                            "similarity_score": 0.025203682527045457
                        },
                        {
                            "class_name": "CrmProductService",
                            "similarity_score": 0.03295745775097154
                        },
                        {
                            "class_name": "AdminUserApi",
                            "similarity_score": 0.05473501819660281
                        },
                        {
                            "class_name": "DeptApi",
                            "similarity_score": 0.06526115091185454
                        }
                    ],
                    "target_classes_sorted_by_llm": [
                        "CrmBusinessService",
                        "CrmProductService",
                        "DeptApi",
                        "AdminUserApi",
                        "CrmContactService"
                    ],
                    "llm_response_time": 2495,
                    "similarity_computation_time": 2,
                    "similarity_metric": "cosine"
                },
                "getBusinessMap": {
                    "target_classes": [
                        {
                            "class_name": "CrmContractService",
                            "similarity_score": 0.005138689153985025
                        },
                        {
                            "class_name": "CrmCustomerService",
                            "similarity_score": 0.014926085659004384
                        },
                        {
                            "class_name": "CrmContactService",
                            "similarity_score": 0.017377700347576103
                        },
                        {
                            "class_name": "CrmBusinessService",
                            "similarity_score": 0.019239442809755272
                        },
                        {
                            "class_name": "CrmProductService",
                            "similarity_score": 0.033020337356358516
                        },
                        {
                            "class_name": "AdminUserApi",
                            "similarity_score": 0.05222804500663884
                        },
                        {
                            "class_name": "DeptApi",
                            "similarity_score": 0.06405126152203486
                        }
                    ],
                    "target_classes_sorted_by_llm": [
                        "CrmBusinessService",
                        "CrmProductService",
                        "CrmContactService",
                        "DeptApi",
                        "AdminUserApi"
                    ],
                    "llm_response_time": 2309,
                    "similarity_computation_time": 2,
                    "similarity_metric": "cosine"
                }
            }
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "29f1eb2c184bf7485734d8f869a236bab337fe25",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/29f1eb2c184bf7485734d8f869a236bab337fe25",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public getBusinessMap(ids Collection<Long>) : Map<Long,CrmBusinessDO> extracted from public getFollowUpRecordPage(pageReqVO CrmFollowUpRecordPageReqVO) : CommonResult<PageResult<CrmFollowUpRecordRespVO>> in class cn.iocoder.yudao.module.crm.controller.admin.followup.CrmFollowUpRecordController & moved to class cn.iocoder.yudao.module.crm.service.business.CrmBusinessService",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/followup/CrmFollowUpRecordController.java",
                    "startLine": 72,
                    "endLine": 90,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public getFollowUpRecordPage(pageReqVO CrmFollowUpRecordPageReqVO) : CommonResult<PageResult<CrmFollowUpRecordRespVO>>"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/followup/CrmFollowUpRecordController.java",
                    "startLine": 81,
                    "endLine": 81,
                    "startColumn": 101,
                    "endColumn": 121,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/followup/CrmFollowUpRecordController.java",
                    "startLine": 80,
                    "endLine": 81,
                    "startColumn": 9,
                    "endColumn": 123,
                    "codeElementType": "VARIABLE_DECLARATION_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/business/CrmBusinessService.java",
                    "startLine": 109,
                    "endLine": 117,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public getBusinessMap(ids Collection<Long>) : Map<Long,CrmBusinessDO>"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/business/CrmBusinessService.java",
                    "startLine": 116,
                    "endLine": 116,
                    "startColumn": 49,
                    "endColumn": 69,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/service/business/CrmBusinessService.java",
                    "startLine": 116,
                    "endLine": 116,
                    "startColumn": 9,
                    "endColumn": 71,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/followup/CrmFollowUpRecordController.java",
                    "startLine": 78,
                    "endLine": 103,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public getFollowUpRecordPage(pageReqVO CrmFollowUpRecordPageReqVO) : CommonResult<PageResult<CrmFollowUpRecordRespVO>>"
                },
                {
                    "filePath": "yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/followup/CrmFollowUpRecordController.java",
                    "startLine": 86,
                    "endLine": 87,
                    "startColumn": 48,
                    "endColumn": 99,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "businessService.getBusinessMap(convertSetByFlatMap(pageResult.getList(),item -> item.getBusinessIds().stream()))"
                }
            ],
            "isStatic": false
        },
        "ref_id": 8,
        "extraction_results": {
            "success": true,
            "newCommitHash": "d1d2d04b2509ed05247f6d8c0ec68bd079c45cf6",
            "newBranchName": "extract-getBusinessMap-getFollowUpRecordPage-3f8fa6b"
        },
        "telemetry": {
            "id": "ae624da9-8344-4112-98ba-9610b0315fe8",
            "hostFunctionTelemetryData": {
                "hostFunctionSize": 64,
                "lineStart": 34,
                "lineEnd": 97,
                "bodyLineStart": 34,
                "language": "java",
                "filePath": "/Users/abhiram/Documents/TBE/evaluation_projects/ruoyi-vue-pro/yudao-module-crm/yudao-module-crm-biz/src/main/java/cn/iocoder/yudao/module/crm/controller/admin/followup/CrmFollowUpRecordController.java",
                "sourceCode": "@Tag(name = \"\u7ba1\u7406\u540e\u53f0 - \u8ddf\u8fdb\u8bb0\u5f55\")\n@RestController\n@RequestMapping(\"/crm/follow-up-record\")\n@Validated\npublic class CrmFollowUpRecordController {\n\n    @Resource\n    private CrmFollowUpRecordService followUpRecordService;\n    @Resource\n    private CrmContactService contactService;\n    @Resource\n    private CrmBusinessService businessService;\n\n    @PostMapping(\"/create\")\n    @Operation(summary = \"\u521b\u5efa\u8ddf\u8fdb\u8bb0\u5f55\")\n    @PreAuthorize(\"@ss.hasPermission('crm:follow-up-record:create')\")\n    public CommonResult<Long> createFollowUpRecord(@Valid @RequestBody CrmFollowUpRecordSaveReqVO createReqVO) {\n        return success(followUpRecordService.createFollowUpRecord(createReqVO));\n    }\n\n    @DeleteMapping(\"/delete\")\n    @Operation(summary = \"\u5220\u9664\u8ddf\u8fdb\u8bb0\u5f55\")\n    @Parameter(name = \"id\", description = \"\u7f16\u53f7\", required = true)\n    @PreAuthorize(\"@ss.hasPermission('crm:follow-up-record:delete')\")\n    public CommonResult<Boolean> deleteFollowUpRecord(@RequestParam(\"id\") Long id) {\n        followUpRecordService.deleteFollowUpRecord(id, getLoginUserId());\n        return success(true);\n    }\n\n    @GetMapping(\"/get\")\n    @Operation(summary = \"\u83b7\u5f97\u8ddf\u8fdb\u8bb0\u5f55\")\n    @Parameter(name = \"id\", description = \"\u7f16\u53f7\", required = true, example = \"1024\")\n    @PreAuthorize(\"@ss.hasPermission('crm:follow-up-record:query')\")\n    public CommonResult<CrmFollowUpRecordRespVO> getFollowUpRecord(@RequestParam(\"id\") Long id) {\n        CrmFollowUpRecordDO followUpRecord = followUpRecordService.getFollowUpRecord(id);\n        return success(BeanUtils.toBean(followUpRecord, CrmFollowUpRecordRespVO.class));\n    }\n\n    @GetMapping(\"/page\")\n    @Operation(summary = \"\u83b7\u5f97\u8ddf\u8fdb\u8bb0\u5f55\u5206\u9875\")\n    @PreAuthorize(\"@ss.hasPermission('crm:follow-up-record:query')\")\n    public CommonResult<PageResult<CrmFollowUpRecordRespVO>> getFollowUpRecordPage(@Valid CrmFollowUpRecordPageReqVO pageReqVO) {\n        PageResult<CrmFollowUpRecordDO> pageResult = followUpRecordService.getFollowUpRecordPage(pageReqVO);\n        /// \u62fc\u63a5\u6570\u636e\n        Map<Long, CrmContactDO> contactMap = convertMap(contactService.getContactList(\n                convertSetByFlatMap(pageResult.getList(), item -> item.getContactIds().stream())), CrmContactDO::getId);\n        Map<Long, CrmBusinessDO> businessMap = getBusinessMap(pageResult);\n        PageResult<CrmFollowUpRecordRespVO> voPageResult = BeanUtils.toBean(pageResult, CrmFollowUpRecordRespVO.class, record -> {\n            record.setContactNames(new ArrayList<>()).setBusinessNames(new ArrayList<>());\n            record.getContactIds().forEach(id -> MapUtils.findAndThen(contactMap, id,\n                    contact -> record.getContactNames().add(contact.getName())));\n            record.getContactIds().forEach(id -> MapUtils.findAndThen(businessMap, id,\n                    business -> record.getBusinessNames().add(business.getName())));\n        });\n        return success(voPageResult);\n    }\n\n    private Map<Long, CrmBusinessDO> getBusinessMap(PageResult<CrmFollowUpRecordDO> pageResult) {\n        Map<Long, CrmBusinessDO> businessMap = convertMap(businessService.getBusinessList(\n                convertSetByFlatMap(pageResult.getList(), item -> item.getBusinessIds().stream())), CrmBusinessDO::getId);\n        return businessMap;\n    }\n\n}"
            },
            "candidatesTelemetryData": {
                "numberOfSuggestions": 1,
                "candidates": [
                    {
                        "lineStart": 90,
                        "lineEnd": 94,
                        "refactoringType": "MyMoveMethodRefactoring",
                        "refactoringInfo": "Move method getBusinessMap to class CrmBusinessService",
                        "description": "Move method getBusinessMap to cn.iocoder.yudao.module.crm.service.business.CrmBusinessService\nRationale: The method is focused on retrieving and converting business data, which aligns with the responsibilities of the CrmBusinessService class.",
                        "couldCreateRefObject": true,
                        "applied": false,
                        "undone": false
                    }
                ]
            },
            "iterationData": [
                {
                    "iteration_num": 1,
                    "suggested_move_methods": [
                        {
                            "method_name": "getBusinessMap",
                            "method_signature": "private Map<Long, CrmBusinessDO> getBusinessMap(PageResult<CrmFollowUpRecordDO> pageResult)",
                            "target_class": "CrmBusinessService",
                            "rationale": "The getBusinessMap method is primarily concerned with retrieving business data based on follow-up records, which aligns more closely with the responsibilities of the CrmBusinessService class."
                        }
                    ],
                    "llm_response_time": 2137
                },
                {
                    "iteration_num": 2,
                    "suggested_move_methods": [
                        {
                            "method_name": "getBusinessMap",
                            "method_signature": "private Map<Long, CrmBusinessDO> getBusinessMap(PageResult<CrmFollowUpRecordDO> pageResult)",
                            "target_class": "CrmBusinessService",
                            "rationale": "The getBusinessMap method is primarily concerned with retrieving business data based on follow-up records, which aligns more closely with the responsibilities of the CrmBusinessService class."
                        }
                    ],
                    "llm_response_time": 2544
                },
                {
                    "iteration_num": 3,
                    "suggested_move_methods": [
                        {
                            "method_name": "getBusinessMap",
                            "method_signature": "private Map<Long, CrmBusinessDO> getBusinessMap(PageResult<CrmFollowUpRecordDO> pageResult)",
                            "target_class": "CrmBusinessService",
                            "rationale": "The getBusinessMap method is primarily concerned with retrieving business data based on follow-up records. It would be more appropriate for this method to reside in the CrmBusinessService class, which is responsible for business-related operations."
                        },
                        {
                            "method_name": "getContactList",
                            "method_signature": "private Map<Long, CrmContactDO> getContactList(Set<Long> contactIds)",
                            "target_class": "CrmContactService",
                            "rationale": "The logic for retrieving contact information is closely related to the CrmContactService. Moving this method to CrmContactService would enhance cohesion and maintainability."
                        }
                    ],
                    "llm_response_time": 2456
                },
                {
                    "iteration_num": -1,
                    "suggested_move_methods": [
                        {
                            "method_name": "getBusinessMap",
                            "method_signature": "private Map<Long, CrmBusinessDO> getBusinessMap(PageResult<CrmFollowUpRecordDO> pageResult)",
                            "target_class": "CrmBusinessService",
                            "rationale": "The getBusinessMap method is primarily concerned with retrieving business data based on follow-up records, which aligns more closely with the responsibilities of the CrmBusinessService class."
                        },
                        {
                            "method_name": "getContactList",
                            "method_signature": "private Map<Long, CrmContactDO> getContactList(Set<Long> contactIds)",
                            "target_class": "CrmContactService",
                            "rationale": "The logic for retrieving contact information is closely related to the CrmContactService. Moving this method to CrmContactService would enhance cohesion and maintainability."
                        }
                    ],
                    "llm_response_time": 0
                }
            ],
            "llmMethodPriority": {
                "priority_method_names": [
                    "getBusinessMap",
                    "getContactList"
                ],
                "llm_response_time": 529
            },
            "targetClassMap": {
                "getBusinessMap": {
                    "target_classes": [
                        {
                            "class_name": "CrmFollowUpRecordService",
                            "similarity_score": 0.011430811153853299
                        },
                        {
                            "class_name": "CrmContactService",
                            "similarity_score": 0.01620478913027409
                        },
                        {
                            "class_name": "CrmBusinessService",
                            "similarity_score": 0.017940872927961326
                        }
                    ],
                    "target_classes_sorted_by_llm": [
                        "CrmBusinessService",
                        "CrmFollowUpRecordService",
                        "CrmContactService"
                    ],
                    "llm_response_time": 3509,
                    "similarity_computation_time": 4,
                    "similarity_metric": "cosine"
                }
            }
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "cdbcd4d673d491ad5203b8cdb05b00919deda6c9",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/cdbcd4d673d491ad5203b8cdb05b00919deda6c9",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public parseInt(str String) : Integer extracted from package getTaskRule(execution DelegateExecution) : BpmTaskAssignRuleDO in class cn.iocoder.yudao.module.bpm.service.definition.BpmTaskAssignRuleServiceImpl & moved to class cn.iocoder.yudao.framework.common.util.number.NumberUtils",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/service/definition/BpmTaskAssignRuleServiceImpl.java",
                    "startLine": 254,
                    "endLine": 267,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "package getTaskRule(execution DelegateExecution) : BpmTaskAssignRuleDO"
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/service/definition/BpmTaskAssignRuleServiceImpl.java",
                    "startLine": 258,
                    "endLine": 258,
                    "startColumn": 13,
                    "endColumn": 40,
                    "codeElementType": "IF_STATEMENT_CONDITION",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/service/definition/BpmTaskAssignRuleServiceImpl.java",
                    "startLine": 258,
                    "endLine": 258,
                    "startColumn": 13,
                    "endColumn": 40,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-framework/yudao-common/src/main/java/cn/iocoder/yudao/framework/common/util/number/NumberUtils.java",
                    "startLine": 19,
                    "endLine": 21,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public parseInt(str String) : Integer"
                },
                {
                    "filePath": "yudao-framework/yudao-common/src/main/java/cn/iocoder/yudao/framework/common/util/number/NumberUtils.java",
                    "startLine": 20,
                    "endLine": 20,
                    "startColumn": 9,
                    "endColumn": 70,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-framework/yudao-common/src/main/java/cn/iocoder/yudao/framework/common/util/number/NumberUtils.java",
                    "startLine": 20,
                    "endLine": 20,
                    "startColumn": 16,
                    "endColumn": 39,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/service/definition/BpmTaskAssignRuleServiceImpl.java",
                    "startLine": 134,
                    "endLine": 169,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "package calculateTaskCandidateUsers0(execution DelegateExecution) : Set<Long>"
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/service/definition/BpmTaskAssignRuleServiceImpl.java",
                    "startLine": 139,
                    "endLine": 139,
                    "startColumn": 24,
                    "endColumn": 119,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "NumberUtils.parseInt(flowElement.getAttributeValue(BpmnModelConstants.NAMESPACE,\"assignType\"))"
                }
            ],
            "isStatic": true
        },
        "ref_id": 9,
        "extraction_results": {
            "success": true,
            "newCommitHash": "65d0ffe3f6181c837eb53e9eaa4b0e05f6a1a5b7",
            "newBranchName": "extract-parseInt-getTaskRule-dda0909"
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "29a0fbfc4339b942d4236ec25eb1ac52c1e216ed",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/29a0fbfc4339b942d4236ec25eb1ac52c1e216ed",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public getTaskStatus(task TaskInfo) : Integer extracted from public buildDoneTaskPage(pageResult PageResult<HistoricTaskInstance>, processInstanceMap Map<String,HistoricProcessInstance>, userMap Map<Long,AdminUserRespDTO>) : PageResult<BpmTaskRespVO> in class cn.iocoder.yudao.module.bpm.convert.task.BpmTaskConvert & moved to class cn.iocoder.yudao.framework.flowable.core.util.FlowableUtils",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 53,
                    "endLine": 70,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public buildDoneTaskPage(pageResult PageResult<HistoricTaskInstance>, processInstanceMap Map<String,HistoricProcessInstance>, userMap Map<Long,AdminUserRespDTO>) : PageResult<BpmTaskRespVO>"
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 58,
                    "endLine": 58,
                    "startColumn": 13,
                    "endColumn": 109,
                    "codeElementType": "EXPRESSION_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-bpm/yudao-spring-boot-starter-flowable/src/main/java/cn/iocoder/yudao/framework/flowable/core/util/FlowableUtils.java",
                    "startLine": 73,
                    "endLine": 75,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public getTaskStatus(task TaskInfo) : Integer"
                },
                {
                    "filePath": "yudao-module-bpm/yudao-spring-boot-starter-flowable/src/main/java/cn/iocoder/yudao/framework/flowable/core/util/FlowableUtils.java",
                    "startLine": 74,
                    "endLine": 74,
                    "startColumn": 9,
                    "endColumn": 74,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 52,
                    "endLine": 68,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public buildDoneTaskPage(pageResult PageResult<HistoricTaskInstance>, processInstanceMap Map<String,HistoricProcessInstance>, userMap Map<Long,AdminUserRespDTO>) : PageResult<BpmTaskRespVO>"
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 57,
                    "endLine": 57,
                    "startColumn": 30,
                    "endColumn": 63,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "FlowableUtils.getTaskStatus(task)"
                }
            ],
            "isStatic": true
        },
        "ref_id": 10,
        "extraction_results": {
            "success": true,
            "newCommitHash": "9ed7c6ed53066d9372124426affb96758af3e572",
            "newBranchName": "extract-getTaskStatus-buildDoneTaskPage-ed83b91"
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "29a0fbfc4339b942d4236ec25eb1ac52c1e216ed",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/29a0fbfc4339b942d4236ec25eb1ac52c1e216ed",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public getTaskStatus(task TaskInfo) : Integer extracted from public buildTaskListByProcessInstanceId(taskList List<HistoricTaskInstance>, processInstance HistoricProcessInstance, userMap Map<Long,AdminUserRespDTO>, deptMap Map<Long,DeptRespDTO>) : List<BpmTaskRespVO> in class cn.iocoder.yudao.module.bpm.convert.task.BpmTaskConvert & moved to class cn.iocoder.yudao.framework.flowable.core.util.FlowableUtils",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 72,
                    "endLine": 112,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public buildTaskListByProcessInstanceId(taskList List<HistoricTaskInstance>, processInstance HistoricProcessInstance, userMap Map<Long,AdminUserRespDTO>, deptMap Map<Long,DeptRespDTO>) : List<BpmTaskRespVO>"
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 78,
                    "endLine": 78,
                    "startColumn": 13,
                    "endColumn": 109,
                    "codeElementType": "EXPRESSION_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-bpm/yudao-spring-boot-starter-flowable/src/main/java/cn/iocoder/yudao/framework/flowable/core/util/FlowableUtils.java",
                    "startLine": 73,
                    "endLine": 75,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public getTaskStatus(task TaskInfo) : Integer"
                },
                {
                    "filePath": "yudao-module-bpm/yudao-spring-boot-starter-flowable/src/main/java/cn/iocoder/yudao/framework/flowable/core/util/FlowableUtils.java",
                    "startLine": 74,
                    "endLine": 74,
                    "startColumn": 9,
                    "endColumn": 74,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 70,
                    "endLine": 110,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public buildTaskListByProcessInstanceId(taskList List<HistoricTaskInstance>, processInstance HistoricProcessInstance, formMap Map<Long,BpmFormDO>, userMap Map<Long,AdminUserRespDTO>, deptMap Map<Long,DeptRespDTO>) : List<BpmTaskRespVO>"
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 77,
                    "endLine": 77,
                    "startColumn": 30,
                    "endColumn": 63,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "FlowableUtils.getTaskStatus(task)"
                }
            ],
            "isStatic": true
        },
        "ref_id": 11,
        "extraction_results": {
            "success": true,
            "newCommitHash": "571645fd39f7cedc557ec4acba7e7b939d62f940",
            "newBranchName": "extract-getTaskStatus-buildTaskListByProcessInstanceId-ed83b91"
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "29a0fbfc4339b942d4236ec25eb1ac52c1e216ed",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/29a0fbfc4339b942d4236ec25eb1ac52c1e216ed",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public getTaskReason(task TaskInfo) : String extracted from public buildDoneTaskPage(pageResult PageResult<HistoricTaskInstance>, processInstanceMap Map<String,HistoricProcessInstance>, userMap Map<Long,AdminUserRespDTO>) : PageResult<BpmTaskRespVO> in class cn.iocoder.yudao.module.bpm.convert.task.BpmTaskConvert & moved to class cn.iocoder.yudao.framework.flowable.core.util.FlowableUtils",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 53,
                    "endLine": 70,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public buildDoneTaskPage(pageResult PageResult<HistoricTaskInstance>, processInstanceMap Map<String,HistoricProcessInstance>, userMap Map<Long,AdminUserRespDTO>) : PageResult<BpmTaskRespVO>"
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 59,
                    "endLine": 59,
                    "startColumn": 13,
                    "endColumn": 108,
                    "codeElementType": "EXPRESSION_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-bpm/yudao-spring-boot-starter-flowable/src/main/java/cn/iocoder/yudao/framework/flowable/core/util/FlowableUtils.java",
                    "startLine": 77,
                    "endLine": 79,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public getTaskReason(task TaskInfo) : String"
                },
                {
                    "filePath": "yudao-module-bpm/yudao-spring-boot-starter-flowable/src/main/java/cn/iocoder/yudao/framework/flowable/core/util/FlowableUtils.java",
                    "startLine": 78,
                    "endLine": 78,
                    "startColumn": 9,
                    "endColumn": 73,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 52,
                    "endLine": 68,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public buildDoneTaskPage(pageResult PageResult<HistoricTaskInstance>, processInstanceMap Map<String,HistoricProcessInstance>, userMap Map<Long,AdminUserRespDTO>) : PageResult<BpmTaskRespVO>"
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 57,
                    "endLine": 57,
                    "startColumn": 75,
                    "endColumn": 108,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "FlowableUtils.getTaskReason(task)"
                }
            ],
            "isStatic": true
        },
        "ref_id": 12,
        "extraction_results": {
            "success": true,
            "newCommitHash": "07200c94ade85036b5c45e149033e1baabd5febc",
            "newBranchName": "extract-getTaskReason-buildDoneTaskPage-ed83b91"
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "29a0fbfc4339b942d4236ec25eb1ac52c1e216ed",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/29a0fbfc4339b942d4236ec25eb1ac52c1e216ed",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public getTaskReason(task TaskInfo) : String extracted from public buildTaskListByProcessInstanceId(taskList List<HistoricTaskInstance>, processInstance HistoricProcessInstance, userMap Map<Long,AdminUserRespDTO>, deptMap Map<Long,DeptRespDTO>) : List<BpmTaskRespVO> in class cn.iocoder.yudao.module.bpm.convert.task.BpmTaskConvert & moved to class cn.iocoder.yudao.framework.flowable.core.util.FlowableUtils",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 72,
                    "endLine": 112,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public buildTaskListByProcessInstanceId(taskList List<HistoricTaskInstance>, processInstance HistoricProcessInstance, userMap Map<Long,AdminUserRespDTO>, deptMap Map<Long,DeptRespDTO>) : List<BpmTaskRespVO>"
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 79,
                    "endLine": 79,
                    "startColumn": 13,
                    "endColumn": 108,
                    "codeElementType": "EXPRESSION_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-bpm/yudao-spring-boot-starter-flowable/src/main/java/cn/iocoder/yudao/framework/flowable/core/util/FlowableUtils.java",
                    "startLine": 77,
                    "endLine": 79,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public getTaskReason(task TaskInfo) : String"
                },
                {
                    "filePath": "yudao-module-bpm/yudao-spring-boot-starter-flowable/src/main/java/cn/iocoder/yudao/framework/flowable/core/util/FlowableUtils.java",
                    "startLine": 78,
                    "endLine": 78,
                    "startColumn": 9,
                    "endColumn": 73,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 70,
                    "endLine": 110,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public buildTaskListByProcessInstanceId(taskList List<HistoricTaskInstance>, processInstance HistoricProcessInstance, formMap Map<Long,BpmFormDO>, userMap Map<Long,AdminUserRespDTO>, deptMap Map<Long,DeptRespDTO>) : List<BpmTaskRespVO>"
                },
                {
                    "filePath": "yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/convert/task/BpmTaskConvert.java",
                    "startLine": 77,
                    "endLine": 77,
                    "startColumn": 75,
                    "endColumn": 108,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "FlowableUtils.getTaskReason(task)"
                }
            ],
            "isStatic": true
        },
        "ref_id": 13,
        "extraction_results": {
            "success": true,
            "newCommitHash": "ab6f2d8379a455e50cb313e116cfa6a25f08a8bf",
            "newBranchName": "extract-getTaskReason-buildTaskListByProcessInstanceId-ed83b91"
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "424210066ff3ce6f5a37d4d6da939d31cdd3eb52",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/424210066ff3ce6f5a37d4d6da939d31cdd3eb52",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public validateAvailable(chatModal AiChatModalRes) : void extracted from public updateConversation(updateReqVO AiChatConversationUpdateReqVO) : Boolean in class cn.iocoder.yudao.module.ai.service.impl.AiChatConversationServiceImpl & moved to class cn.iocoder.yudao.module.ai.service.impl.AiChatModalServiceImpl",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/impl/AiChatConversationServiceImpl.java",
                    "startLine": 87,
                    "endLine": 101,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public updateConversation(updateReqVO AiChatConversationUpdateReqVO) : Boolean"
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/impl/AiChatConversationServiceImpl.java",
                    "startLine": 95,
                    "endLine": 95,
                    "startColumn": 13,
                    "endColumn": 96,
                    "codeElementType": "THROW_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/impl/AiChatConversationServiceImpl.java",
                    "startLine": 94,
                    "endLine": 96,
                    "startColumn": 9,
                    "endColumn": 10,
                    "codeElementType": "IF_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/impl/AiChatConversationServiceImpl.java",
                    "startLine": 94,
                    "endLine": 96,
                    "startColumn": 83,
                    "endColumn": 10,
                    "codeElementType": "BLOCK",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/impl/AiChatModalServiceImpl.java",
                    "startLine": 119,
                    "endLine": 125,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public validateAvailable(chatModal AiChatModalRes) : void"
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/impl/AiChatModalServiceImpl.java",
                    "startLine": 123,
                    "endLine": 123,
                    "startColumn": 13,
                    "endColumn": 96,
                    "codeElementType": "THROW_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/impl/AiChatModalServiceImpl.java",
                    "startLine": 122,
                    "endLine": 124,
                    "startColumn": 9,
                    "endColumn": 10,
                    "codeElementType": "IF_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/impl/AiChatModalServiceImpl.java",
                    "startLine": 122,
                    "endLine": 124,
                    "startColumn": 83,
                    "endColumn": 10,
                    "codeElementType": "BLOCK",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/impl/AiChatConversationServiceImpl.java",
                    "startLine": 86,
                    "endLine": 98,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public updateConversation(updateReqVO AiChatConversationUpdateReqVO) : Boolean"
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/impl/AiChatConversationServiceImpl.java",
                    "startLine": 93,
                    "endLine": 93,
                    "startColumn": 9,
                    "endColumn": 56,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "aiChatModalService.validateAvailable(chatModal)"
                }
            ],
            "isStatic": false
        },
        "ref_id": 14,
        "extraction_results": {
            "success": true,
            "newCommitHash": "03f78f37afdc0f87b207087e52557c7d1809339c",
            "newBranchName": "extract-validateAvailable-updateConversation-f86e24b"
        },
        "telemetry": {
            "id": "905aace1-0237-4ec2-a49c-e3fb684c11bb",
            "hostFunctionTelemetryData": {
                "hostFunctionSize": 107,
                "lineStart": 29,
                "lineEnd": 135,
                "bodyLineStart": 29,
                "language": "java",
                "filePath": "/Users/abhiram/Documents/TBE/evaluation_projects/ruoyi-vue-pro/yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/impl/AiChatConversationServiceImpl.java",
                "sourceCode": "/**\n * chat \u5bf9\u8bdd\n *\n * @fansili\n * @since v1.0\n */\n@Service\n@Slf4j\n@AllArgsConstructor\npublic class AiChatConversationServiceImpl implements AiChatConversationService {\n\n    private final AiChatModalMapper aiChatModalMapper;\n    private final AiChatModalService aiChatModalService;\n    private final AiChatRoleService aiChatRoleService;\n    private final AiChatConversationMapper aiChatConversationMapper;\n\n    @Override\n    public Long createConversation(AiChatConversationCreateReqVO req) {\n        // \u83b7\u53d6\u7528\u6237id\n        Long loginUserId = SecurityFrameworkUtils.getLoginUserId();\n        // \u9ed8\u8ba4\u4f7f\u7528 sort \u6392\u5e8f\u7b2c\u4e00\u4e2a\u6a21\u578b\n        AiChatModalDO aiChatModalDO = aiChatModalMapper.selectFirstModal();\n        // \u67e5\u8be2\u89d2\u8272\n        AiChatRoleRes chatRoleRes = null;\n        if (req.getRoleId() != null) {\n            chatRoleRes = aiChatRoleService.getChatRole(req.getRoleId());\n        }\n        Long chatRoleId = chatRoleRes != null ? chatRoleRes.getId() : null;\n        // \u521b\u5efa\u65b0\u7684 Conversation\n        AiChatConversationDO insertConversation = saveConversation(AiCommonConstants.CONVERSATION_DEFAULT_TITLE,\n                loginUserId, chatRoleId, aiChatModalDO.getId(), aiChatModalDO.getModel()\n        );\n        // \u8fd4\u56de\u5bf9\u8bddid\n        return insertConversation.getId();\n    }\n\n    private @NotNull AiChatConversationDO saveConversation(String title,\n                                                           Long userId,\n                                                           Long roleId,\n                                                           Long modalId,\n                                                           String model) {\n        AiChatConversationDO insertConversation = new AiChatConversationDO();\n        insertConversation.setId(null);\n        insertConversation.setUserId(userId);\n        insertConversation.setTitle(title);\n        insertConversation.setPinned(false);\n\n        insertConversation.setRoleId(roleId);\n        insertConversation.setModelId(modalId);\n        insertConversation.setModel(model);\n\n        insertConversation.setTemperature(null);\n        insertConversation.setMaxTokens(null);\n        insertConversation.setMaxContexts(null);\n        aiChatConversationMapper.insert(insertConversation);\n        return insertConversation;\n    }\n\n    @Override\n    public Boolean updateConversation(AiChatConversationUpdateReqVO updateReqVO) {\n        // \u6821\u9a8c\u5bf9\u8bdd\u662f\u5426\u5b58\u5728\n        validateExists(updateReqVO.getId());\n        // \u83b7\u53d6\u6a21\u578b\u4fe1\u606f\u5e76\u9a8c\u8bc1\n        AiChatModalRes chatModal = aiChatModalService.getChatModalOfValidate(updateReqVO.getModelId());\n        // \u6821\u9a8cmodal\u662f\u5426\u53ef\u7528\n        validateAvailable(chatModal);\n        // \u66f4\u65b0\u5bf9\u8bdd\u4fe1\u606f\n        AiChatConversationDO updateAiChatConversationDO\n                = AiChatConversationConvert.INSTANCE.convertAiChatConversationDO(updateReqVO);\n        return aiChatConversationMapper.updateById(updateAiChatConversationDO) > 0;\n    }\n\n    private void validateAvailable(AiChatModalRes chatModal) {\n        if (AiChatModalDisableEnum.YES.getValue().equals(chatModal.getDisable())) {\n            throw ServiceExceptionUtil.exception(ErrorCodeConstants.AI_MODAL_DISABLE_NOT_USED);\n        }\n    }\n\n    @Override\n    public List<AiChatConversationRespVO> listConversation(AiChatConversationListReqVO listReqVO) {\n        // \u83b7\u53d6\u7528\u6237id\n        Long loginUserId = SecurityFrameworkUtils.getLoginUserId();\n        // \u67e5\u8be2\u524d100\u5bf9\u8bdd\n        List<AiChatConversationDO> top100Conversation\n                = aiChatConversationMapper.selectTop100Conversation(loginUserId, listReqVO.getTitle());\n        return AiChatConversationConvert.INSTANCE.covnertChatConversationResList(top100Conversation);\n    }\n\n    @Override\n    public AiChatConversationRespVO getConversationOfValidate(Long id) {\n        AiChatConversationDO aiChatConversationDO = validateExists(id);\n        return AiChatConversationConvert.INSTANCE.covnertChatConversationRes(aiChatConversationDO);\n    }\n\n    @Override\n    public Boolean deleteConversation(Long id) {\n        return aiChatConversationMapper.deleteById(id) > 0;\n    }\n\n    private @NotNull AiChatConversationDO validateExists(Long id) {\n        AiChatConversationDO aiChatConversationDO = aiChatConversationMapper.selectById(id);\n        if (aiChatConversationDO == null) {\n            throw ServiceExceptionUtil.exception(ErrorCodeConstants.AI_CONVERSATION_NOT_EXISTS);\n        }\n        return aiChatConversationDO;\n    }\n}"
            },
            "candidatesTelemetryData": {
                "numberOfSuggestions": 0,
                "candidates": []
            },
            "processingTime": {
                "llmResponseTime": -1,
                "pluginProcessingTime": -1,
                "totalTime": 18054
            },
            "iterationData": [
                {
                    "iteration_num": 1,
                    "suggested_move_methods": [
                        {
                            "method_name": "saveConversation",
                            "method_signature": "private @NotNull AiChatConversationDO saveConversation(String title, Long userId, Long roleId, Long modalId, String model)",
                            "target_class": "AiChatConversationFactory",
                            "rationale": "The saveConversation method is responsible for creating and initializing an AiChatConversationDO object. Moving it to a dedicated factory class (AiChatConversationFactory) would adhere to the Single Responsibility Principle, separating the creation logic from the service logic."
                        },
                        {
                            "method_name": "validateAvailable",
                            "method_signature": "private void validateAvailable(AiChatModalRes chatModal)",
                            "target_class": "AiChatModalService",
                            "rationale": "The validateAvailable method checks the availability of a chat modal, which is closely related to the responsibilities of the AiChatModalService. Moving it there would improve cohesion and keep related logic together."
                        },
                        {
                            "method_name": "validateExists",
                            "method_signature": "private @NotNull AiChatConversationDO validateExists(Long id)",
                            "target_class": "AiChatConversationService",
                            "rationale": "The validateExists method is a validation utility that checks for the existence of a conversation. It could be moved to a dedicated validation class or utility within the AiChatConversationService to enhance code organization and reusability."
                        }
                    ],
                    "llm_response_time": 3435
                },
                {
                    "iteration_num": 2,
                    "suggested_move_methods": [
                        {
                            "method_name": "saveConversation",
                            "method_signature": "private @NotNull AiChatConversationDO saveConversation(String title, Long userId, Long roleId, Long modalId, String model)",
                            "target_class": "AiChatConversationFactory",
                            "rationale": "The saveConversation method is responsible for creating and initializing an AiChatConversationDO object. Moving it to a dedicated factory class (AiChatConversationFactory) would adhere to the Single Responsibility Principle, separating the creation logic from the service logic."
                        },
                        {
                            "method_name": "validateAvailable",
                            "method_signature": "private void validateAvailable(AiChatModalRes chatModal)",
                            "target_class": "AiChatModalService",
                            "rationale": "The validateAvailable method checks the availability of a chat modal, which is closely related to the responsibilities of the AiChatModalService. Moving it there would improve cohesion and keep related logic together."
                        },
                        {
                            "method_name": "validateExists",
                            "method_signature": "private @NotNull AiChatConversationDO validateExists(Long id)",
                            "target_class": "AiChatConversationService",
                            "rationale": "The validateExists method is primarily concerned with checking the existence of a conversation. It could be moved to a dedicated validation class or service that handles all validation logic related to conversations, improving separation of concerns."
                        }
                    ],
                    "llm_response_time": 5028
                },
                {
                    "iteration_num": 3,
                    "suggested_move_methods": [
                        {
                            "method_name": "saveConversation",
                            "method_signature": "private @NotNull AiChatConversationDO saveConversation(String title, Long userId, Long roleId, Long modalId, String model)",
                            "target_class": "AiChatConversationFactory",
                            "rationale": "The saveConversation method is responsible for creating and initializing an AiChatConversationDO object. Moving it to a dedicated factory class (AiChatConversationFactory) would adhere to the Single Responsibility Principle, separating the creation logic from the service logic."
                        },
                        {
                            "method_name": "validateAvailable",
                            "method_signature": "private void validateAvailable(AiChatModalRes chatModal)",
                            "target_class": "AiChatModalService",
                            "rationale": "The validateAvailable method checks the availability of a chat modal, which is closely related to the responsibilities of the AiChatModalService. Moving it there would improve cohesion and keep related logic together."
                        },
                        {
                            "method_name": "validateExists",
                            "method_signature": "private @NotNull AiChatConversationDO validateExists(Long id)",
                            "target_class": "AiChatConversationValidator",
                            "rationale": "The validateExists method is focused on validating the existence of a conversation. Moving it to a dedicated validator class (AiChatConversationValidator) would enhance code organization and maintainability."
                        }
                    ],
                    "llm_response_time": 3654
                },
                {
                    "iteration_num": -1,
                    "suggested_move_methods": [
                        {
                            "method_name": "saveConversation",
                            "method_signature": "private @NotNull AiChatConversationDO saveConversation(String title, Long userId, Long roleId, Long modalId, String model)",
                            "target_class": "AiChatConversationFactory",
                            "rationale": "The saveConversation method is responsible for creating and initializing an AiChatConversationDO object. Moving it to a dedicated factory class (AiChatConversationFactory) would adhere to the Single Responsibility Principle, separating the creation logic from the service logic."
                        },
                        {
                            "method_name": "validateAvailable",
                            "method_signature": "private void validateAvailable(AiChatModalRes chatModal)",
                            "target_class": "AiChatModalService",
                            "rationale": "The validateAvailable method checks the availability of a chat modal, which is closely related to the responsibilities of the AiChatModalService. Moving it there would improve cohesion and keep related logic together."
                        },
                        {
                            "method_name": "validateExists",
                            "method_signature": "private @NotNull AiChatConversationDO validateExists(Long id)",
                            "target_class": "AiChatConversationService",
                            "rationale": "The validateExists method is a validation utility that checks for the existence of a conversation. It could be moved to a dedicated validation class or utility within the AiChatConversationService to enhance code organization and reusability."
                        }
                    ],
                    "llm_response_time": 0
                }
            ],
            "llmMethodPriority": {
                "priority_method_names": [
                    "validateExists",
                    "validateAvailable",
                    "saveConversation"
                ],
                "llm_response_time": 955
            },
            "targetClassMap": {
                "validateExists": {
                    "target_classes": [],
                    "target_classes_sorted_by_llm": [],
                    "llm_response_time": 1779,
                    "similarity_computation_time": 0,
                    "similarity_metric": "cosine"
                },
                "validateAvailable": {
                    "target_classes": [],
                    "target_classes_sorted_by_llm": [],
                    "llm_response_time": 1680,
                    "similarity_computation_time": 0,
                    "similarity_metric": "cosine"
                },
                "saveConversation": {
                    "target_classes": [],
                    "target_classes_sorted_by_llm": [],
                    "llm_response_time": 1306,
                    "similarity_computation_time": 0,
                    "similarity_metric": "cosine"
                }
            }
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "7c1e949d77315754d0c0377e7bea8df1764a8e1a",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/7c1e949d77315754d0c0377e7bea8df1764a8e1a",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public selectByStatusAndPlatform(statusEnum AiImageStatusEnum, platformEnum AiPlatformEnum) : List<AiImageDO> extracted from public execute(param String) : String in class cn.iocoder.yudao.module.ai.job.MidjourneyJob & moved to class cn.iocoder.yudao.module.ai.dal.mysql.image.AiImageMapper",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/job/MidjourneyJob.java",
                    "startLine": 42,
                    "endLine": 82,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public execute(param String) : String"
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/job/MidjourneyJob.java",
                    "startLine": 51,
                    "endLine": 51,
                    "startColumn": 29,
                    "endColumn": 51,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/job/MidjourneyJob.java",
                    "startLine": 50,
                    "endLine": 50,
                    "startColumn": 29,
                    "endColumn": 49,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/job/MidjourneyJob.java",
                    "startLine": 48,
                    "endLine": 52,
                    "startColumn": 9,
                    "endColumn": 11,
                    "codeElementType": "VARIABLE_DECLARATION_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/dal/mysql/image/AiImageMapper.java",
                    "startLine": 59,
                    "endLine": 69,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public selectByStatusAndPlatform(statusEnum AiImageStatusEnum, platformEnum AiPlatformEnum) : List<AiImageDO>"
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/dal/mysql/image/AiImageMapper.java",
                    "startLine": 67,
                    "endLine": 67,
                    "startColumn": 21,
                    "endColumn": 43,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/dal/mysql/image/AiImageMapper.java",
                    "startLine": 66,
                    "endLine": 66,
                    "startColumn": 21,
                    "endColumn": 41,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/dal/mysql/image/AiImageMapper.java",
                    "startLine": 65,
                    "endLine": 68,
                    "startColumn": 9,
                    "endColumn": 11,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/job/MidjourneyJob.java",
                    "startLine": 40,
                    "endLine": 72,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public execute(param String) : String"
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/job/MidjourneyJob.java",
                    "startLine": 43,
                    "endLine": 43,
                    "startColumn": 37,
                    "endColumn": 132,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "imageMapper.selectByStatusAndPlatform(AiImageStatusEnum.IN_PROGRESS,AiPlatformEnum.MIDJOURNEY)"
                }
            ],
            "isStatic": false
        },
        "ref_id": 15,
        "extraction_results": {
            "success": true,
            "newCommitHash": "9bd531bedf21668537a95d15c4ab5d519a42f18e",
            "newBranchName": "extract-selectByStatusAndPlatform-execute-aa7c2cb"
        },
        "telemetry": {
            "id": "985e946e-8279-4b7a-a6dd-1ecf904a5981",
            "hostFunctionTelemetryData": {
                "hostFunctionSize": 68,
                "lineStart": 22,
                "lineEnd": 89,
                "bodyLineStart": 22,
                "language": "java",
                "filePath": "/Users/abhiram/Documents/TBE/evaluation_projects/ruoyi-vue-pro/yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/job/MidjourneyJob.java",
                "sourceCode": "/**\n * midjourney job \u5b9a\u65f6\u62c9\u53bb midjourney \u7ed8\u5236\u72b6\u6001\n *\n * @author fansili\n * @time 2024/6/5 14:55\n * @since 1.0\n */\n@Component\n@Slf4j\npublic class MidjourneyJob implements JobHandler {\n\n    // TODO @fan\uff1a@Resource\n    @Autowired\n    private MidjourneyApi midjourneyApi;\n    @Autowired\n    private AiImageMapper imageMapper;\n    @Autowired\n    private AiImageService imageService;\n\n    // TODO @fan\uff1a\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u5efa\u8bae\u5b9e\u73b0\u5230 AiImageService\uff0c\u4f8b\u5982\u8bf4 midjourneySync\uff0c\u8fd4\u56de int \u540c\u6b65\u6570\u91cf\u3002\n    @Override\n    public String execute(String param) throws Exception {\n        // 1\u3001\u83b7\u53d6 midjourney \u5e73\u53f0\uff0c\u72b6\u6001\u5728 \u201c\u8fdb\u884c\u4e2d\u201d \u7684 image\n        // TODO @fan\uff1a43 \u548c 51 \u5176\u5b9e\u6709\u70b9\u91cd\u53e0\uff0c\u65e5\u5fd7\uff0c\u5efa\u8bae\u53ea\u6253 51\n        log.info(\"Midjourney \u540c\u6b65 - \u5f00\u59cb...\");\n        // TODO @fan\uff1aJob\u3001Service \u7b49\u4e1a\u52a1\u5c42\uff0c\u4e0d\u8981\u76f4\u63a5\u4f7f\u7528 LambdaUpdateWrapper\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4 mapper \u7a7f\u900f\u5230\u903b\u8f91\u5c42\u3002\u8981\u6536\u655b\u5230 mapper \u91cc\u3002\n        List<AiImageDO> imageList = selectByStatusAndPlatform();\n        log.info(\"Midjourney \u540c\u6b65 - \u4efb\u52a1\u6570\u91cf {}!\", imageList.size());\n        if (CollUtil.isEmpty(imageList)) {\n            // TODO @fan\uff1a51 \u548c 54\uff0c\u5176\u5b9e\u6709\u70b9\u91cd\u53e0\u3002\u5efa\u8bae 51 \u632a\u5230 55 \u4e4b\u540e\u6253\u3002\n            return \"Midjourney \u540c\u6b65 - \u6570\u91cf\u4e3a\u7a7a!\";\n        }\n        // 2\u3001\u6279\u91cf\u62c9\u53bb task \u4fe1\u606f\n        // TODO @fan\uff1aimageList.stream().map(AiImageDO::getTaskId).collect(Collectors.toSet()))\uff0c\u53ef\u4ee5\u4f7f\u7528 CollectionUtils.convertSet \u7b80\u5316\n        List<MidjourneyApi.NotifyRequest> taskList = midjourneyApi\n                .listByCondition(imageList.stream().map(AiImageDO::getTaskId).collect(Collectors.toSet()));\n        // TODO @fan\uff1ataskList.stream().collect(Collectors.toMap(MidjourneyNotifyReqVO::getId, o -> o))\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 CollectionUtils.convertMap\uff1b\u672c\u8d28\u4e0a\uff0c\u91cd\u7528 set\u3001map \u8f6c\u6362\uff0c\u8981 convert \u7b80\u5316\n        Map<String, MidjourneyApi.NotifyRequest> taskIdMap = taskList.stream().collect(Collectors.toMap(MidjourneyApi.NotifyRequest::id, o -> o));\n        // 3\u3001\u66f4\u65b0 image \u72b6\u6001\n        List<AiImageDO> updateImageList = new ArrayList<>();\n        for (AiImageDO aiImageDO : imageList) {\n            // 3.1 \u6392\u9664\u6389\u7a7a\u7684\u60c5\u51b5\n            if (!taskIdMap.containsKey(aiImageDO.getTaskId())) {\n                log.warn(\"Midjourney \u540c\u6b65 - {} \u4efb\u52a1\u4e3a\u7a7a!\", aiImageDO.getTaskId());\n                continue;\n            }\n            // TODO @ 3.1 \u548c 3.2 \u662f\u4e0d\u662f\u878d\u5408\u4e0b\uff1bget\uff0c\u7136\u540e\u5224\u7a7a\uff0ccontinue\uff1b\n            // 3.2 \u83b7\u53d6\u901a\u77e5\u5bf9\u8c61\n//            MidjourneyNotifyReqVO notifyReqVO = taskIdMap.get(aiImageDO.getTaskId());\n            // 3.2 \u6784\u5efa\u66f4\u65b0\u5bf9\u8c61\n            // TODO @fan\uff1a\u5efa\u8bae List<MidjourneyNotifyReqVO> \u4f5c\u4e3a imageService \u53bb\u66f4\u65b0\uff1b\n//            updateImageList.add(imageService.buildUpdateImage(aiImageDO.getId(), notifyReqVO));\n        }\n        // 4\u3001\u6279\u4e86\u66f4\u65b0 updateImageList\n        imageMapper.updateBatch(updateImageList);\n        return \"Midjourney \u540c\u6b65 - \".concat(String.valueOf(updateImageList.size())).concat(\" \u4efb\u52a1!\");\n    }\n\n    private List<AiImageDO> selectByStatusAndPlatform() {\n        List<AiImageDO> imageList = imageMapper.selectList(\n                new LambdaUpdateWrapper<AiImageDO>()\n                        .eq(AiImageDO::getStatus, AiImageStatusEnum.IN_PROGRESS.getStatus())\n                        .eq(AiImageDO::getPlatform, AiPlatformEnum.MIDJOURNEY.getPlatform())\n        );\n        return imageList;\n    }\n\n}"
            },
            "candidatesTelemetryData": {
                "numberOfSuggestions": 0,
                "candidates": []
            },
            "processingTime": {
                "llmResponseTime": -1,
                "pluginProcessingTime": -1,
                "totalTime": 12378
            },
            "iterationData": [
                {
                    "iteration_num": 1,
                    "suggested_move_methods": [
                        {
                            "method_name": "execute",
                            "method_signature": "public String execute(String param) throws Exception",
                            "target_class": "AiImageService",
                            "rationale": "The execute method contains logic that is closely related to image processing and synchronization, which would be more appropriately handled within the AiImageService class."
                        },
                        {
                            "method_name": "selectByStatusAndPlatform",
                            "method_signature": "private List<AiImageDO> selectByStatusAndPlatform()",
                            "target_class": "AiImageMapper",
                            "rationale": "The selectByStatusAndPlatform method is primarily concerned with data retrieval from the database, which aligns more closely with the responsibilities of the AiImageMapper class."
                        }
                    ],
                    "llm_response_time": 3399
                },
                {
                    "iteration_num": 2,
                    "suggested_move_methods": [
                        {
                            "method_name": "execute",
                            "method_signature": "public String execute(String param) throws Exception",
                            "target_class": "AiImageService",
                            "rationale": "The execute method contains logic that is primarily concerned with managing and updating image statuses, which aligns more closely with the responsibilities of the AiImageService. Moving this method would help adhere to the Single Responsibility Principle."
                        },
                        {
                            "method_name": "selectByStatusAndPlatform",
                            "method_signature": "private List<AiImageDO> selectByStatusAndPlatform()",
                            "target_class": "AiImageMapper",
                            "rationale": "The selectByStatusAndPlatform method is directly interacting with the database to retrieve image data based on specific criteria. This functionality is more appropriate for the AiImageMapper class, which is responsible for data access operations."
                        }
                    ],
                    "llm_response_time": 2348
                },
                {
                    "iteration_num": 3,
                    "suggested_move_methods": [
                        {
                            "method_name": "execute",
                            "method_signature": "public String execute(String param) throws Exception",
                            "target_class": "AiImageService",
                            "rationale": "The execute method contains logic that is primarily concerned with managing and updating image statuses, which aligns more closely with the responsibilities of the AiImageService. Moving it there would adhere to the Single Responsibility Principle."
                        },
                        {
                            "method_name": "selectByStatusAndPlatform",
                            "method_signature": "private List<AiImageDO> selectByStatusAndPlatform()",
                            "target_class": "AiImageMapper",
                            "rationale": "The selectByStatusAndPlatform method is directly querying the database for AiImageDO objects based on specific criteria. This functionality is more appropriate for the AiImageMapper class, which is responsible for data access operations."
                        }
                    ],
                    "llm_response_time": 2149
                },
                {
                    "iteration_num": -1,
                    "suggested_move_methods": [
                        {
                            "method_name": "execute",
                            "method_signature": "public String execute(String param) throws Exception",
                            "target_class": "AiImageService",
                            "rationale": "The execute method contains logic that is closely related to image processing and synchronization, which would be more appropriately handled within the AiImageService class."
                        },
                        {
                            "method_name": "selectByStatusAndPlatform",
                            "method_signature": "private List<AiImageDO> selectByStatusAndPlatform()",
                            "target_class": "AiImageMapper",
                            "rationale": "The selectByStatusAndPlatform method is primarily concerned with data retrieval from the database, which aligns more closely with the responsibilities of the AiImageMapper class."
                        }
                    ],
                    "llm_response_time": 0
                }
            ],
            "llmMethodPriority": {
                "priority_method_names": [
                    "execute",
                    "selectByStatusAndPlatform"
                ],
                "llm_response_time": 505
            },
            "targetClassMap": {
                "execute": {
                    "target_classes": [],
                    "target_classes_sorted_by_llm": [],
                    "llm_response_time": 1965,
                    "similarity_computation_time": 0,
                    "similarity_metric": "cosine"
                },
                "selectByStatusAndPlatform": {
                    "target_classes": [],
                    "target_classes_sorted_by_llm": [],
                    "llm_response_time": 1858,
                    "similarity_computation_time": 0,
                    "similarity_metric": "cosine"
                }
            }
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "285a431616e8cfcf55f6f473cf0ef918c9799bc3",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/285a431616e8cfcf55f6f473cf0ef918c9799bc3",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public updateConversationLastMessage(kefuMessage KeFuMessageDO) : void extracted from public sendKefuMessage(sendReqVO KeFuMessageSendReqVO) : Long in class cn.iocoder.yudao.module.promotion.service.kefu.KeFuMessageServiceImpl & moved to class cn.iocoder.yudao.module.promotion.service.kefu.KeFuConversationServiceImpl",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuMessageServiceImpl.java",
                    "startLine": 54,
                    "endLine": 82,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public sendKefuMessage(sendReqVO KeFuMessageSendReqVO) : Long"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuMessageServiceImpl.java",
                    "startLine": 76,
                    "endLine": 76,
                    "startColumn": 13,
                    "endColumn": 112,
                    "codeElementType": "EXPRESSION_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuMessageServiceImpl.java",
                    "startLine": 75,
                    "endLine": 77,
                    "startColumn": 9,
                    "endColumn": 10,
                    "codeElementType": "IF_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuMessageServiceImpl.java",
                    "startLine": 75,
                    "endLine": 77,
                    "startColumn": 136,
                    "endColumn": 10,
                    "codeElementType": "BLOCK",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                    "startLine": 47,
                    "endLine": 66,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public updateConversationLastMessage(kefuMessage KeFuMessageDO) : void"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                    "startLine": 64,
                    "endLine": 64,
                    "startColumn": 13,
                    "endColumn": 92,
                    "codeElementType": "EXPRESSION_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                    "startLine": 62,
                    "endLine": 65,
                    "startColumn": 9,
                    "endColumn": 10,
                    "codeElementType": "IF_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                    "startLine": 63,
                    "endLine": 65,
                    "startColumn": 73,
                    "endColumn": 10,
                    "codeElementType": "BLOCK",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuMessageServiceImpl.java",
                    "startLine": 50,
                    "endLine": 67,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public sendKefuMessage(sendReqVO KeFuMessageSendReqVO) : Long"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuMessageServiceImpl.java",
                    "startLine": 62,
                    "endLine": 62,
                    "startColumn": 9,
                    "endColumn": 71,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "conversationService.updateConversationLastMessage(kefuMessage)"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                    "startLine": 51,
                    "endLine": 51,
                    "startColumn": 9,
                    "endColumn": 107,
                    "codeElementType": "VARIABLE_DECLARATION_STATEMENT",
                    "description": "added statement in extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                    "startLine": 53,
                    "endLine": 55,
                    "startColumn": 9,
                    "endColumn": 75,
                    "codeElementType": "EXPRESSION_STATEMENT",
                    "description": "added statement in extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                    "startLine": 59,
                    "endLine": 59,
                    "startColumn": 13,
                    "endColumn": 95,
                    "codeElementType": "EXPRESSION_STATEMENT",
                    "description": "added statement in extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                    "startLine": 58,
                    "endLine": 60,
                    "startColumn": 81,
                    "endColumn": 10,
                    "codeElementType": "BLOCK",
                    "description": "added statement in extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                    "startLine": 58,
                    "endLine": 60,
                    "startColumn": 9,
                    "endColumn": 10,
                    "codeElementType": "IF_STATEMENT",
                    "description": "added statement in extracted method declaration",
                    "codeElement": null
                }
            ],
            "isStatic": false
        },
        "ref_id": 16,
        "extraction_results": {
            "success": true,
            "newCommitHash": "f2281c70cec384b33cc8713ac727cb0b1ca8fe2b",
            "newBranchName": "extract-updateConversationLastMessage-sendKefuMessage-d89a19a"
        },
        "telemetry": {
            "id": "394c98cc-3671-47d4-a017-54248e015d98",
            "hostFunctionTelemetryData": {
                "hostFunctionSize": 112,
                "lineStart": 28,
                "lineEnd": 139,
                "bodyLineStart": 28,
                "language": "java",
                "filePath": "/Users/abhiram/Documents/TBE/evaluation_projects/ruoyi-vue-pro/yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuMessageServiceImpl.java",
                "sourceCode": "/**\n * \u5ba2\u670d\u6d88\u606f Service \u5b9e\u73b0\u7c7b\n *\n * @author HUIHUI\n */\n@Service\n@Validated\npublic class KeFuMessageServiceImpl implements KeFuMessageService {\n\n    // TODO @puhui999\uff1a@\u828b\u827f\uff1a\u6349\u6478\u8981\u4e0d\u8981\u62ff\u5230\u4e00\u4e2a\u5730\u65b9\u679a\u4e3e\uff1b\n    private static final String KEFU_MESSAGE_TYPE = \"kefu_message_type\"; // \u5ba2\u670d\u6d88\u606f\u7c7b\u578b\n\n    // TODO @puhui999\uff1akefuMessageMapper\uff1b\u56e0\u4e3a messageMapper \u53ef\u80fd\u4f1a\u91cd\u53e0\n    @Resource\n    private KeFuMessageMapper messageMapper;\n\n    @Resource\n    private KeFuConversationService conversationService;\n\n    @Resource\n    private AdminUserApi adminUserApi;\n    @Resource\n    private MemberUserApi memberUserApi;\n    @Resource\n    private WebSocketSenderApi webSocketSenderApi;\n\n    @Override\n    @Transactional(rollbackFor = Exception.class)\n    public Long sendKefuMessage(KeFuMessageSendReqVO sendReqVO) {\n        // 1.1 \u6821\u9a8c\u4f1a\u8bdd\u662f\u5426\u5b58\u5728\n        KeFuConversationDO conversation = conversationService.validateKefuConversationExists(sendReqVO.getConversationId());\n        // 1.2 \u6821\u9a8c\u63a5\u6536\u4eba\u662f\u5426\u5b58\u5728\n        validateReceiverExist(sendReqVO.getReceiverId(), sendReqVO.getReceiverType());\n\n        // 2.1 \u4fdd\u5b58\u6d88\u606f\n        KeFuMessageDO kefuMessage = BeanUtils.toBean(sendReqVO, KeFuMessageDO.class);\n        messageMapper.insert(kefuMessage);\n        // TODO @puhui999\uff1a\u662f\u4e0d\u662f updateConversationMessage\uff0c\u91cc\u9762\u7edf\u4e00\u5904\u7406\u672a\u8bfb\u3001\u6062\u590d\uff1b\u76f4\u63a5\u8bbe\u7f6e KeFuMessageDO \u4f5c\u4e3a\u53c2\u6570\u597d\u4e86\u3002\u3002\u3002\n        // 2.2 \u66f4\u65b0\u4f1a\u8bdd\u6d88\u606f\u5197\u4f59\n        conversationService.updateConversationMessage(kefuMessage.getConversationId(), LocalDateTime.now(),\n                kefuMessage.getContent(), kefuMessage.getContentType());\n        // 2.3 \u66f4\u65b0\u7ba1\u7406\u5458\u672a\u8bfb\u6d88\u606f\u6570\n        if (UserTypeEnum.ADMIN.getValue().equals(kefuMessage.getReceiverType())) {\n            conversationService.updateAdminUnreadMessageCountByConversationId(kefuMessage.getConversationId(), 1);\n        }\n        // 2.4 \u4f1a\u5458\u7528\u6237\u53d1\u9001\u6d88\u606f\u65f6\uff0c\u5982\u679c\u7ba1\u7406\u5458\u5220\u9664\u8fc7\u4f1a\u8bdd\u5219\u8fdb\u884c\u6062\u590d\n        // TODO @puhui999\uff1a\u5efa\u8bae && \u6362\u4e00\u884c\n        updateConversationLastMessage(conversation, kefuMessage);\n\n        // 3. \u53d1\u9001\u6d88\u606f\n        getSelf().sendAsyncMessage(sendReqVO.getReceiverType(), sendReqVO.getReceiverId(), kefuMessage);\n        return kefuMessage.getId();\n    }\n\n    private void updateConversationLastMessage(KeFuConversationDO conversation, KeFuMessageDO kefuMessage) {\n        if (UserTypeEnum.MEMBER.getValue().equals(kefuMessage.getSenderType()) && Boolean.TRUE.equals(conversation.getAdminDeleted())) {\n            conversationService.updateConversationAdminDeleted(kefuMessage.getConversationId(), Boolean.FALSE);\n        }\n    }\n\n    @Override\n    @Transactional(rollbackFor = Exception.class)\n    public void updateKefuMessageReadStatus(Long conversationId, Long receiverId) {\n        // 1.1 \u6821\u9a8c\u4f1a\u8bdd\u662f\u5426\u5b58\u5728\n        conversationService.validateKefuConversationExists(conversationId);\n        // 1.2 \u67e5\u8be2\u63a5\u6536\u4eba\u6240\u6709\u7684\u672a\u8bfb\u6d88\u606f\n        // TODO @puhui999\uff1a\u5e94\u8be5\u4e0d\u80fd receiverId \u8fc7\u6ee4\u54c8\u3002\u56e0\u4e3a\u591a\u4e2a\u5ba2\u670d\uff0c\u4e00\u4e2a\u4eba\u70b9\u4e86\uff0c\u5c31\u90fd\u70b9\u4e86\u3002\n        List<KeFuMessageDO> messageList = messageMapper.selectListByConversationIdAndReceiverIdAndReadStatus(\n                conversationId, receiverId, Boolean.FALSE);\n        // 1.3 \u60c5\u51b5\u4e00\uff1a\u6ca1\u6709\u672a\u8bfb\u6d88\u606f\n        if (CollUtil.isEmpty(messageList)) {\n            return;\n        }\n\n        // 2.1 \u60c5\u51b5\u4e8c\uff1a\u66f4\u65b0\u672a\u8bfb\u6d88\u606f\u72b6\u6001\u4e3a\u5df2\u8bfb\n        messageMapper.updateReadStstusBatchByIds(convertSet(messageList, KeFuMessageDO::getId), Boolean.TRUE);\n        // 2.2 \u66f4\u65b0\u7ba1\u7406\u5458\u672a\u8bfb\u6d88\u606f\u6570\n        KeFuMessageDO message = getFirst(messageList);\n        assert message != null;\n        if (UserTypeEnum.ADMIN.getValue().equals(message.getReceiverType())) {\n            conversationService.updateAdminUnreadMessageCountByConversationId(conversationId, 0);\n        }\n\n        // 2.3 \u53d1\u9001\u6d88\u606f\u901a\u77e5\u53d1\u9001\u8005\uff0c\u63a5\u6536\u8005\u5df2\u8bfb -> \u53d1\u9001\u8005\u66f4\u65b0\u53d1\u9001\u7684\u6d88\u606f\u72b6\u6001\n        // TODO @puhui999\uff1a\u5f85\u5b9a~\n        getSelf().sendAsyncMessage(message.getSenderType(), message.getSenderId(), \"keFuMessageReadStatusChange\");\n    }\n\n    private void validateReceiverExist(Long receiverId, Integer receiverType) {\n        if (UserTypeEnum.ADMIN.getValue().equals(receiverType)) {\n            adminUserApi.validateUser(receiverId);\n        }\n        if (UserTypeEnum.MEMBER.getValue().equals(receiverType)) {\n            memberUserApi.validateUser(receiverId);\n        }\n    }\n\n    @Async\n    public void sendAsyncMessage(Integer userType, Long userId, Object content) {\n        webSocketSenderApi.sendObject(userType, userId, KEFU_MESSAGE_TYPE, content);\n    }\n\n    @Override\n    public PageResult<KeFuMessageDO> getKefuMessagePage(KeFuMessagePageReqVO pageReqVO) {\n        return messageMapper.selectPage(pageReqVO);\n    }\n\n    private KeFuMessageServiceImpl getSelf() {\n        return SpringUtil.getBean(getClass());\n    }\n\n}"
            },
            "candidatesTelemetryData": {
                "numberOfSuggestions": 0,
                "candidates": []
            },
            "processingTime": {
                "llmResponseTime": -1,
                "pluginProcessingTime": -1,
                "totalTime": 23733
            },
            "iterationData": [
                {
                    "iteration_num": 1,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateReceiverExist",
                            "method_signature": "private void validateReceiverExist(Long receiverId, Integer receiverType)",
                            "target_class": "UserService",
                            "rationale": "The method validateReceiverExist() is responsible for validating the existence of a user based on their type (Admin or Member). This functionality is more aligned with user management and should be moved to a dedicated UserService class."
                        },
                        {
                            "method_name": "sendAsyncMessage",
                            "method_signature": "public void sendAsyncMessage(Integer userType, Long userId, Object content)",
                            "target_class": "WebSocketService",
                            "rationale": "The sendAsyncMessage() method is focused on sending messages via WebSocket. It should be moved to a WebSocketService class that handles all WebSocket-related operations."
                        },
                        {
                            "method_name": "updateConversationLastMessage",
                            "method_signature": "private void updateConversationLastMessage(KeFuConversationDO conversation, KeFuMessageDO kefuMessage)",
                            "target_class": "ConversationService",
                            "rationale": "The updateConversationLastMessage() method deals with updating the last message in a conversation, which is a responsibility that fits better within the ConversationService class."
                        }
                    ],
                    "llm_response_time": 3688
                },
                {
                    "iteration_num": 2,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateReceiverExist",
                            "method_signature": "private void validateReceiverExist(Long receiverId, Integer receiverType)",
                            "target_class": "UserService",
                            "rationale": "The method validateReceiverExist() is responsible for validating the existence of a user based on their type (Admin or Member). This functionality is more aligned with user management and should be moved to a dedicated UserService class."
                        },
                        {
                            "method_name": "sendAsyncMessage",
                            "method_signature": "public void sendAsyncMessage(Integer userType, Long userId, Object content)",
                            "target_class": "WebSocketService",
                            "rationale": "The method sendAsyncMessage() is focused on sending messages asynchronously via WebSocket. It should be moved to a WebSocketService class that handles all WebSocket-related operations."
                        },
                        {
                            "method_name": "updateConversationLastMessage",
                            "method_signature": "private void updateConversationLastMessage(KeFuConversationDO conversation, KeFuMessageDO kefuMessage)",
                            "target_class": "ConversationService",
                            "rationale": "The method updateConversationLastMessage() deals with updating the last message in a conversation, which is a responsibility that fits better within the ConversationService class."
                        }
                    ],
                    "llm_response_time": 4650
                },
                {
                    "iteration_num": 3,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateReceiverExist",
                            "method_signature": "private void validateReceiverExist(Long receiverId, Integer receiverType)",
                            "target_class": "UserService",
                            "rationale": "The method validateReceiverExist() is responsible for validating the existence of a user based on their type (Admin or Member). This functionality is more aligned with user management and should be moved to a dedicated UserService class."
                        },
                        {
                            "method_name": "sendAsyncMessage",
                            "method_signature": "public void sendAsyncMessage(Integer userType, Long userId, Object content)",
                            "target_class": "WebSocketService",
                            "rationale": "The sendAsyncMessage() method is focused on sending messages via WebSocket. It should be moved to a WebSocketService class that handles all WebSocket-related operations."
                        },
                        {
                            "method_name": "updateConversationLastMessage",
                            "method_signature": "private void updateConversationLastMessage(KeFuConversationDO conversation, KeFuMessageDO kefuMessage)",
                            "target_class": "ConversationService",
                            "rationale": "The updateConversationLastMessage() method deals with updating the last message in a conversation, which is a responsibility that fits better within the ConversationService class."
                        },
                        {
                            "method_name": "getSelf",
                            "method_signature": "private KeFuMessageServiceImpl getSelf()",
                            "target_class": "ServiceLocator",
                            "rationale": "The getSelf() method is used to retrieve the current instance of the service. This functionality is more appropriate in a ServiceLocator class that can manage service instances."
                        }
                    ],
                    "llm_response_time": 5625
                },
                {
                    "iteration_num": -1,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateReceiverExist",
                            "method_signature": "private void validateReceiverExist(Long receiverId, Integer receiverType)",
                            "target_class": "UserService",
                            "rationale": "The method validateReceiverExist() is responsible for validating the existence of a user based on their type (Admin or Member). This functionality is more aligned with user management and should be moved to a dedicated UserService class."
                        },
                        {
                            "method_name": "sendAsyncMessage",
                            "method_signature": "public void sendAsyncMessage(Integer userType, Long userId, Object content)",
                            "target_class": "WebSocketService",
                            "rationale": "The sendAsyncMessage() method is focused on sending messages via WebSocket. It should be moved to a WebSocketService class that handles all WebSocket-related operations."
                        },
                        {
                            "method_name": "updateConversationLastMessage",
                            "method_signature": "private void updateConversationLastMessage(KeFuConversationDO conversation, KeFuMessageDO kefuMessage)",
                            "target_class": "ConversationService",
                            "rationale": "The updateConversationLastMessage() method deals with updating the last message in a conversation, which is a responsibility that fits better within the ConversationService class."
                        },
                        {
                            "method_name": "getSelf",
                            "method_signature": "private KeFuMessageServiceImpl getSelf()",
                            "target_class": "ServiceLocator",
                            "rationale": "The getSelf() method is used to retrieve the current instance of the service. This functionality is more appropriate in a ServiceLocator class that can manage service instances."
                        }
                    ],
                    "llm_response_time": 0
                }
            ],
            "llmMethodPriority": {
                "priority_method_names": [
                    "validateReceiverExist",
                    "sendAsyncMessage",
                    "updateConversationLastMessage",
                    "getSelf"
                ],
                "llm_response_time": 754
            },
            "targetClassMap": {
                "validateReceiverExist": {
                    "target_classes": [],
                    "target_classes_sorted_by_llm": [],
                    "llm_response_time": 1476,
                    "similarity_computation_time": 0,
                    "similarity_metric": "cosine"
                },
                "sendAsyncMessage": {
                    "target_classes": [],
                    "target_classes_sorted_by_llm": [],
                    "llm_response_time": 1625,
                    "similarity_computation_time": 0,
                    "similarity_metric": "cosine"
                },
                "updateConversationLastMessage": {
                    "target_classes": [],
                    "target_classes_sorted_by_llm": [],
                    "llm_response_time": 4329,
                    "similarity_computation_time": 0,
                    "similarity_metric": "cosine"
                },
                "getSelf": {
                    "target_classes": [],
                    "target_classes_sorted_by_llm": [],
                    "llm_response_time": 1389,
                    "similarity_computation_time": 0,
                    "similarity_metric": "cosine"
                }
            }
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "4ce2be724e91bf9838baa1cc9562f698bf8e2aa9",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/4ce2be724e91bf9838baa1cc9562f698bf8e2aa9",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public selectByUserId(userId Long) : KeFuConversationDO extracted from public getConversationByUserId(userId Long) : KeFuConversationDO in class cn.iocoder.yudao.module.promotion.service.kefu.KeFuConversationServiceImpl & moved to class cn.iocoder.yudao.module.promotion.dal.mysql.kefu.KeFuConversationMapper",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                    "startLine": 108,
                    "endLine": 112,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public getConversationByUserId(userId Long) : KeFuConversationDO"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                    "startLine": 111,
                    "endLine": 111,
                    "startColumn": 9,
                    "endColumn": 84,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                    "startLine": 111,
                    "endLine": 111,
                    "startColumn": 45,
                    "endColumn": 74,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/dal/mysql/kefu/KeFuConversationMapper.java",
                    "startLine": 31,
                    "endLine": 33,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public selectByUserId(userId Long) : KeFuConversationDO"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/dal/mysql/kefu/KeFuConversationMapper.java",
                    "startLine": 32,
                    "endLine": 32,
                    "startColumn": 9,
                    "endColumn": 65,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/dal/mysql/kefu/KeFuConversationMapper.java",
                    "startLine": 32,
                    "endLine": 32,
                    "startColumn": 26,
                    "endColumn": 55,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                    "startLine": 109,
                    "endLine": 112,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public getConversationByUserId(userId Long) : KeFuConversationDO"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                    "startLine": 111,
                    "endLine": 111,
                    "startColumn": 16,
                    "endColumn": 57,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "conversationMapper.selectByUserId(userId)"
                }
            ],
            "isStatic": false
        },
        "ref_id": 17,
        "extraction_results": {
            "success": true,
            "newCommitHash": "99ad74c9d145a9d7884c7a110c6541e19ae0c140",
            "newBranchName": "extract-selectByUserId-getConversationByUserId-866b385"
        },
        "telemetry": {
            "id": "176150c0-6fe3-4367-85bd-4b6743e779c1",
            "hostFunctionTelemetryData": {
                "hostFunctionSize": 98,
                "lineStart": 21,
                "lineEnd": 118,
                "bodyLineStart": 21,
                "language": "java",
                "filePath": "/Users/abhiram/Documents/TBE/evaluation_projects/ruoyi-vue-pro/yudao-module-mall/yudao-module-promotion-biz/src/main/java/cn/iocoder/yudao/module/promotion/service/kefu/KeFuConversationServiceImpl.java",
                "sourceCode": "/**\n * \u5ba2\u670d\u4f1a\u8bdd Service \u5b9e\u73b0\u7c7b\n *\n * @author HUIHUI\n */\n@Service\n@Validated\npublic class KeFuConversationServiceImpl implements KeFuConversationService {\n\n    @Resource\n    private KeFuConversationMapper conversationMapper;\n\n    @Override\n    public void deleteKefuConversation(Long id) {\n        // \u6821\u9a8c\u5b58\u5728\n        validateKefuConversationExists(id);\n\n        // \u53ea\u6709\u7ba1\u7406\u5458\u7aef\u53ef\u4ee5\u5220\u9664\u4f1a\u8bdd\uff0c\u4e5f\u4e0d\u771f\u7684\u5220\uff0c\u53ea\u662f\u7ba1\u7406\u5458\u7aef\u770b\u4e0d\u5230\u5566\n        conversationMapper.updateById(new KeFuConversationDO().setId(id).setAdminDeleted(Boolean.TRUE));\n    }\n\n    @Override\n    public void updateConversationPinnedByAdmin(KeFuConversationUpdatePinnedReqVO updateReqVO) {\n        conversationMapper.updateById(new KeFuConversationDO().setId(updateReqVO.getId()).setAdminPinned(updateReqVO.getAdminPinned()));\n    }\n\n    @Override\n    @Transactional(rollbackFor = Exception.class)\n    public void updateConversationLastMessage(KeFuMessageDO kefuMessage) {\n        // 1.1 \u6821\u9a8c\u4f1a\u8bdd\u662f\u5426\u5b58\u5728\n        KeFuConversationDO conversation = validateKefuConversationExists(kefuMessage.getConversationId());\n        // 1.2 \u66f4\u65b0\u4f1a\u8bdd\u6d88\u606f\u5197\u4f59\n        conversationMapper.updateById(new KeFuConversationDO().setId(kefuMessage.getConversationId())\n                .setLastMessageTime(kefuMessage.getCreateTime()).setLastMessageContent(kefuMessage.getContent())\n                .setLastMessageContentType(kefuMessage.getContentType()));\n\n        // 2.1 \u66f4\u65b0\u7ba1\u7406\u5458\u672a\u8bfb\u6d88\u606f\u6570\n        if (UserTypeEnum.MEMBER.getValue().equals(kefuMessage.getSenderType())) {\n            conversationMapper.updateAdminUnreadMessageCount(kefuMessage.getConversationId());\n        }\n        // 2.2 \u4f1a\u5458\u7528\u6237\u53d1\u9001\u6d88\u606f\u65f6\uff0c\u5982\u679c\u7ba1\u7406\u5458\u5220\u9664\u8fc7\u4f1a\u8bdd\u5219\u8fdb\u884c\u6062\u590d\n        // TODO @puhui999\uff1a\u5176\u5b9e\u4e0d\u7528\u5224\u65ad\u7528\u6237\u7c7b\u578b\uff1b\u53ea\u8981be\u5df2\u5220\u9664\uff0c\u5c31\u6062\u590d\uff01\n        if (UserTypeEnum.MEMBER.getValue().equals(kefuMessage.getSenderType())\n                && Boolean.TRUE.equals(conversation.getAdminDeleted())) {\n            updateConversationAdminDeleted(kefuMessage.getConversationId(), Boolean.FALSE);\n        }\n    }\n\n    @Override\n    public void updateAdminUnreadMessageCountWithZero(Long id) {\n        validateKefuConversationExists(id);\n        conversationMapper.updateAdminUnreadMessageCountWithZero(id);\n    }\n\n    @Override\n    public void updateConversationAdminDeleted(Long id, Boolean adminDeleted) {\n        conversationMapper.updateById(new KeFuConversationDO().setId(id).setAdminDeleted(adminDeleted));\n    }\n\n    @Override\n    public List<KeFuConversationDO> getKefuConversationList() {\n        return conversationMapper.selectConversationList();\n    }\n\n    @Override\n    public KeFuConversationDO getOrCreateConversation(Long userId) {\n        KeFuConversationDO conversation = conversationMapper.selectOne(KeFuConversationDO::getUserId, userId);\n        // \u6ca1\u6709\u5386\u53f2\u4f1a\u8bdd\uff0c\u5219\u521d\u59cb\u5316\u4e00\u4e2a\u65b0\u4f1a\u8bdd\n        if (conversation == null) {\n            conversation = new KeFuConversationDO().setUserId(userId).setLastMessageTime(LocalDateTime.now())\n                    .setLastMessageContent(StrUtil.EMPTY).setLastMessageContentType(KeFuMessageContentTypeEnum.TEXT.getType())\n                    .setAdminPinned(Boolean.FALSE).setUserDeleted(Boolean.FALSE).setAdminDeleted(Boolean.FALSE)\n                    .setAdminUnreadMessageCount(0);\n            conversationMapper.insert(conversation);\n        }\n        return conversation;\n    }\n\n    @Override\n    public KeFuConversationDO validateKefuConversationExists(Long id) {\n        KeFuConversationDO conversation = conversationMapper.selectById(id);\n        if (conversation == null) {\n            throw exception(KEFU_CONVERSATION_NOT_EXISTS);\n        }\n        return conversation;\n    }\n\n    @Override\n    public KeFuConversationDO getConversationByUserId(Long userId) {\n        // TODO @puhui999\uff1aservice \u4e0d\u5199 dao \u7684\u903b\u8f91\u54c8\n        return selectByUserId(userId);\n    }\n\n    private KeFuConversationDO selectByUserId(Long userId) {\n        return conversationMapper.selectOne(KeFuConversationDO::getUserId, userId);\n    }\n\n}"
            },
            "candidatesTelemetryData": {
                "numberOfSuggestions": 0,
                "candidates": []
            },
            "processingTime": {
                "llmResponseTime": -1,
                "pluginProcessingTime": -1,
                "totalTime": 12750
            },
            "iterationData": [
                {
                    "iteration_num": 1,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateKefuConversationExists",
                            "method_signature": "public KeFuConversationDO validateKefuConversationExists(Long id)",
                            "target_class": "KeFuConversationValidator",
                            "rationale": "The method validateKefuConversationExists() is primarily responsible for validating the existence of a conversation. Moving it to a dedicated validator class would separate concerns and improve the readability and maintainability of the service class."
                        },
                        {
                            "method_name": "selectByUserId",
                            "method_signature": "private KeFuConversationDO selectByUserId(Long userId)",
                            "target_class": "KeFuConversationRepository",
                            "rationale": "The method selectByUserId() is a data access operation that retrieves a conversation based on user ID. It should be moved to a repository class to adhere to the single responsibility principle and to keep data access logic separate from business logic."
                        }
                    ],
                    "llm_response_time": 2868
                },
                {
                    "iteration_num": 2,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateKefuConversationExists",
                            "method_signature": "public KeFuConversationDO validateKefuConversationExists(Long id)",
                            "target_class": "KeFuConversationValidator",
                            "rationale": "The method validateKefuConversationExists() is primarily responsible for validating the existence of a conversation. Moving it to a dedicated validator class would separate concerns and improve the readability and maintainability of the service class."
                        },
                        {
                            "method_name": "selectByUserId",
                            "method_signature": "private KeFuConversationDO selectByUserId(Long userId)",
                            "target_class": "KeFuConversationRepository",
                            "rationale": "The method selectByUserId() is a data access operation that retrieves a conversation based on the user ID. It should be moved to a repository class to adhere to the single responsibility principle and to keep data access logic separate from business logic."
                        }
                    ],
                    "llm_response_time": 2761
                },
                {
                    "iteration_num": 3,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateKefuConversationExists",
                            "method_signature": "public KeFuConversationDO validateKefuConversationExists(Long id)",
                            "target_class": "KefuConversationValidator",
                            "rationale": "This method is responsible for validating the existence of a conversation, which is a validation concern. Moving it to a dedicated validator class will separate concerns and improve code organization."
                        },
                        {
                            "method_name": "selectByUserId",
                            "method_signature": "private KeFuConversationDO selectByUserId(Long userId)",
                            "target_class": "KefuConversationRepository",
                            "rationale": "This method directly interacts with the data layer to retrieve a conversation by user ID. It should be moved to a repository class to adhere to the repository pattern and keep data access logic separate from service logic."
                        }
                    ],
                    "llm_response_time": 2592
                },
                {
                    "iteration_num": -1,
                    "suggested_move_methods": [
                        {
                            "method_name": "validateKefuConversationExists",
                            "method_signature": "public KeFuConversationDO validateKefuConversationExists(Long id)",
                            "target_class": "KeFuConversationValidator",
                            "rationale": "The method validateKefuConversationExists() is primarily responsible for validating the existence of a conversation. Moving it to a dedicated validator class would separate concerns and improve the readability and maintainability of the service class."
                        },
                        {
                            "method_name": "selectByUserId",
                            "method_signature": "private KeFuConversationDO selectByUserId(Long userId)",
                            "target_class": "KeFuConversationRepository",
                            "rationale": "The method selectByUserId() is a data access operation that retrieves a conversation based on user ID. It should be moved to a repository class to adhere to the single responsibility principle and to keep data access logic separate from business logic."
                        }
                    ],
                    "llm_response_time": 0
                }
            ],
            "llmMethodPriority": {
                "priority_method_names": [
                    "validateKefuConversationExists",
                    "selectByUserId"
                ],
                "llm_response_time": 584
            },
            "targetClassMap": {
                "validateKefuConversationExists": {
                    "target_classes": [],
                    "target_classes_sorted_by_llm": [],
                    "llm_response_time": 1616,
                    "similarity_computation_time": 0,
                    "similarity_metric": "cosine"
                },
                "selectByUserId": {
                    "target_classes": [],
                    "target_classes_sorted_by_llm": [],
                    "llm_response_time": 2204,
                    "similarity_computation_time": 0,
                    "similarity_metric": "cosine"
                }
            }
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "6e71b721e85a5e31f0522733a9f32621a83e3be1",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/6e71b721e85a5e31f0522733a9f32621a83e3be1",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public validateType(type Integer) : void extracted from private buildWritingPrompt(generateReqVO AiWriteGenerateReqVO) : String in class cn.iocoder.yudao.module.ai.service.write.AiWriteServiceImpl & moved to class cn.iocoder.yudao.module.ai.enums.write.AiWriteTypeEnum",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/write/AiWriteServiceImpl.java",
                    "startLine": 90,
                    "endLine": 108,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "private buildWritingPrompt(generateReqVO AiWriteGenerateReqVO) : String"
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/write/AiWriteServiceImpl.java",
                    "startLine": 106,
                    "endLine": 106,
                    "startColumn": 13,
                    "endColumn": 89,
                    "codeElementType": "THROW_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-api/src/main/java/cn/iocoder/yudao/module/ai/enums/write/AiWriteTypeEnum.java",
                    "startLine": 44,
                    "endLine": 47,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public validateType(type Integer) : void"
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-api/src/main/java/cn/iocoder/yudao/module/ai/enums/write/AiWriteTypeEnum.java",
                    "startLine": 46,
                    "endLine": 46,
                    "startColumn": 9,
                    "endColumn": 80,
                    "codeElementType": "THROW_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/write/AiWriteServiceImpl.java",
                    "startLine": 115,
                    "endLine": 130,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "private buildWritingPrompt(generateReqVO AiWriteGenerateReqVO) : String"
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-biz/src/main/java/cn/iocoder/yudao/module/ai/service/write/AiWriteServiceImpl.java",
                    "startLine": 123,
                    "endLine": 123,
                    "startColumn": 9,
                    "endColumn": 43,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "AiWriteTypeEnum.validateType(type)"
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-api/src/main/java/cn/iocoder/yudao/module/ai/enums/write/AiWriteTypeEnum.java",
                    "startLine": 45,
                    "endLine": 45,
                    "startColumn": 47,
                    "endColumn": 54,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "added statement in extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-ai/yudao-module-ai-api/src/main/java/cn/iocoder/yudao/module/ai/enums/write/AiWriteTypeEnum.java",
                    "startLine": 45,
                    "endLine": 45,
                    "startColumn": 9,
                    "endColumn": 54,
                    "codeElementType": "IF_STATEMENT",
                    "description": "added statement in extracted method declaration",
                    "codeElement": null
                }
            ],
            "isStatic": true
        },
        "ref_id": 18,
        "extraction_results": {
            "success": true,
            "newCommitHash": "63c585fe6e7d450fd1dc23e02b351bd8a0d81527",
            "newBranchName": "extract-validateType-buildWritingPrompt-ae69b13"
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "401de3034479bf8787b22fc4e9f6c6b7f9f03c73",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/401de3034479bf8787b22fc4e9f6c6b7f9f03c73",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public getSpuMap(ids Collection<Long>) : Map<Long,ProductSpuDO> extracted from public getBrowseHistoryPage(pageReqVO ProductBrowseHistoryPageReqVO) : CommonResult<PageResult<ProductBrowseHistoryRespVO>> in class cn.iocoder.yudao.module.product.controller.admin.history.ProductBrowseHistoryController & moved to class cn.iocoder.yudao.module.product.service.spu.ProductSpuService",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/controller/admin/history/ProductBrowseHistoryController.java",
                    "startLine": 42,
                    "endLine": 57,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "public getBrowseHistoryPage(pageReqVO ProductBrowseHistoryPageReqVO) : CommonResult<PageResult<ProductBrowseHistoryRespVO>>"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/controller/admin/history/ProductBrowseHistoryController.java",
                    "startLine": 53,
                    "endLine": 53,
                    "startColumn": 91,
                    "endColumn": 110,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/controller/admin/history/ProductBrowseHistoryController.java",
                    "startLine": 53,
                    "endLine": 53,
                    "startColumn": 9,
                    "endColumn": 112,
                    "codeElementType": "VARIABLE_DECLARATION_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/service/spu/ProductSpuService.java",
                    "startLine": 62,
                    "endLine": 71,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public getSpuMap(ids Collection<Long>) : Map<Long,ProductSpuDO>"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/service/spu/ProductSpuService.java",
                    "startLine": 70,
                    "endLine": 70,
                    "startColumn": 49,
                    "endColumn": 68,
                    "codeElementType": "LAMBDA_EXPRESSION_BODY",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/service/spu/ProductSpuService.java",
                    "startLine": 70,
                    "endLine": 70,
                    "startColumn": 9,
                    "endColumn": 70,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/controller/admin/history/ProductBrowseHistoryController.java",
                    "startLine": 40,
                    "endLine": 55,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "public getBrowseHistoryPage(pageReqVO ProductBrowseHistoryPageReqVO) : CommonResult<PageResult<ProductBrowseHistoryRespVO>>"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/controller/admin/history/ProductBrowseHistoryController.java",
                    "startLine": 50,
                    "endLine": 51,
                    "startColumn": 42,
                    "endColumn": 84,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "productSpuService.getSpuMap(convertSet(pageResult.getList(),ProductBrowseHistoryDO::getSpuId))"
                },
                {
                    "filePath": "yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/service/spu/ProductSpuService.java",
                    "startLine": 69,
                    "endLine": 69,
                    "startColumn": 9,
                    "endColumn": 51,
                    "codeElementType": "VARIABLE_DECLARATION_STATEMENT",
                    "description": "added statement in extracted method declaration",
                    "codeElement": null
                }
            ],
            "isStatic": false
        },
        "ref_id": 19,
        "extraction_results": {
            "success": true,
            "newCommitHash": "2df8667d786d5879d9a7d8dfbddb804b5808d3a9",
            "newBranchName": "extract-getSpuMap-getBrowseHistoryPage-65ef6ff"
        },
        "telemetry": {
            "id": "05fc39d5-eac9-47dd-be7f-992258129499",
            "hostFunctionTelemetryData": {
                "hostFunctionSize": 34,
                "lineStart": 31,
                "lineEnd": 64,
                "bodyLineStart": 31,
                "language": "java",
                "filePath": "/Users/abhiram/Documents/TBE/evaluation_projects/ruoyi-vue-pro/yudao-module-mall/yudao-module-product-biz/src/main/java/cn/iocoder/yudao/module/product/controller/admin/history/ProductBrowseHistoryController.java",
                "sourceCode": "@Tag(name = \"\u7ba1\u7406\u540e\u53f0 - \u5546\u54c1\u6d4f\u89c8\u8bb0\u5f55\")\n@RestController\n@RequestMapping(\"/product/browse-history\")\n@Validated\npublic class ProductBrowseHistoryController {\n\n    @Resource\n    private ProductBrowseHistoryService browseHistoryService;\n    @Resource\n    private ProductSpuService productSpuService;\n\n    @GetMapping(\"/page\")\n    @Operation(summary = \"\u83b7\u5f97\u5546\u54c1\u6d4f\u89c8\u8bb0\u5f55\u5206\u9875\")\n    @PreAuthorize(\"@ss.hasPermission('product:browse-history:query')\")\n    public CommonResult<PageResult<ProductBrowseHistoryRespVO>> getBrowseHistoryPage(@Valid ProductBrowseHistoryPageReqVO pageReqVO) {\n        PageResult<ProductBrowseHistoryDO> pageResult = browseHistoryService.getBrowseHistoryPage(pageReqVO);\n        if (CollUtil.isEmpty(pageResult.getList())) {\n            return success(PageResult.empty());\n        }\n\n        // \u5f97\u5230\u5546\u54c1 spu \u4fe1\u606f\n        Set<Long> spuIds = convertSet(pageResult.getList(), ProductBrowseHistoryDO::getSpuId);\n        Map<Long, ProductSpuDO> spuMap = getSpuMap(spuIds);\n        return success(BeanUtils.toBean(pageResult, ProductBrowseHistoryRespVO.class,\n                vo -> Optional.ofNullable(spuMap.get(vo.getSpuId()))\n                        .ifPresent(spu -> vo.setSpuName(spu.getName()).setPicUrl(spu.getPicUrl()).setPrice(spu.getPrice()))));\n    }\n\n    private Map<Long, ProductSpuDO> getSpuMap(Set<Long> spuIds) {\n        Map<Long, ProductSpuDO> spuMap = convertMap(productSpuService.getSpuList(spuIds), ProductSpuDO::getId);\n        return spuMap;\n    }\n\n}"
            },
            "candidatesTelemetryData": {
                "numberOfSuggestions": 0,
                "candidates": []
            },
            "processingTime": {
                "llmResponseTime": -1,
                "pluginProcessingTime": -1,
                "totalTime": 8247
            },
            "iterationData": [
                {
                    "iteration_num": 1,
                    "suggested_move_methods": [
                        {
                            "method_name": "getSpuMap",
                            "method_signature": "private Map<Long, ProductSpuDO> getSpuMap(Set<Long> spuIds)",
                            "target_class": "ProductSpuService",
                            "rationale": "The getSpuMap method is primarily responsible for retrieving and mapping ProductSpuDO objects, which is a core responsibility of the ProductSpuService. Moving it there would adhere to the Single Responsibility Principle."
                        }
                    ],
                    "llm_response_time": 2066
                },
                {
                    "iteration_num": 2,
                    "suggested_move_methods": [
                        {
                            "method_name": "getSpuMap",
                            "method_signature": "private Map<Long, ProductSpuDO> getSpuMap(Set<Long> spuIds)",
                            "target_class": "ProductSpuService",
                            "rationale": "The getSpuMap method is primarily responsible for retrieving and mapping ProductSpuDO objects based on their IDs, which aligns more closely with the responsibilities of the ProductSpuService class."
                        }
                    ],
                    "llm_response_time": 1535
                },
                {
                    "iteration_num": 3,
                    "suggested_move_methods": [
                        {
                            "method_name": "getSpuMap",
                            "method_signature": "private Map<Long, ProductSpuDO> getSpuMap(Set<Long> spuIds)",
                            "target_class": "ProductSpuService",
                            "rationale": "The getSpuMap method is primarily responsible for retrieving and mapping ProductSpuDO objects based on their IDs, which aligns more closely with the responsibilities of the ProductSpuService class."
                        }
                    ],
                    "llm_response_time": 1634
                },
                {
                    "iteration_num": -1,
                    "suggested_move_methods": [
                        {
                            "method_name": "getSpuMap",
                            "method_signature": "private Map<Long, ProductSpuDO> getSpuMap(Set<Long> spuIds)",
                            "target_class": "ProductSpuService",
                            "rationale": "The getSpuMap method is primarily responsible for retrieving and mapping ProductSpuDO objects, which is a core responsibility of the ProductSpuService. Moving it there would adhere to the Single Responsibility Principle."
                        }
                    ],
                    "llm_response_time": 0
                }
            ],
            "llmMethodPriority": {
                "priority_method_names": [
                    "getSpuMap"
                ],
                "llm_response_time": 397
            },
            "targetClassMap": {
                "getSpuMap": {
                    "target_classes": [],
                    "target_classes_sorted_by_llm": [],
                    "llm_response_time": 2475,
                    "similarity_computation_time": 0,
                    "similarity_metric": "cosine"
                }
            }
        }
    },
    {
        "repository": "https://github.com/YunaiV/ruoyi-vue-pro.git",
        "sha1": "22686bafa29a9628ef4dbe54c7d1acd11055a714",
        "url": "https://github.com/YunaiV/ruoyi-vue-pro/commit/22686bafa29a9628ef4dbe54c7d1acd11055a714",
        "move_method_refactoring": {
            "type": "Extract And Move Method",
            "description": "Extract And Move Method public post(url String, headers Map<String,String>, requestBody String) : String extracted from private request(apiName String, queryParams TreeMap<String,Object>) : JSONObject in class cn.iocoder.yudao.module.system.framework.sms.core.client.impl.AliyunSmsClient & moved to class cn.iocoder.yudao.framework.common.util.http.HttpUtils",
            "leftSideLocations": [
                {
                    "filePath": "yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/framework/sms/core/client/impl/AliyunSmsClient.java",
                    "startLine": 130,
                    "endLine": 183,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration before extraction",
                    "codeElement": "private request(apiName String, queryParams TreeMap<String,Object>) : JSONObject"
                },
                {
                    "filePath": "yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/framework/sms/core/client/impl/AliyunSmsClient.java",
                    "startLine": 181,
                    "endLine": 181,
                    "startColumn": 13,
                    "endColumn": 55,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/framework/sms/core/client/impl/AliyunSmsClient.java",
                    "startLine": 181,
                    "endLine": 181,
                    "startColumn": 38,
                    "endColumn": 53,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/framework/sms/core/client/impl/AliyunSmsClient.java",
                    "startLine": 179,
                    "endLine": 182,
                    "startColumn": 9,
                    "endColumn": 10,
                    "codeElementType": "TRY_STATEMENT",
                    "description": "extracted code from source method declaration",
                    "codeElement": null
                }
            ],
            "rightSideLocations": [
                {
                    "filePath": "yudao-framework/yudao-common/src/main/java/cn/iocoder/yudao/framework/common/util/http/HttpUtils.java",
                    "startLine": 127,
                    "endLine": 144,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "extracted method declaration",
                    "codeElement": "public post(url String, headers Map<String,String>, requestBody String) : String"
                },
                {
                    "filePath": "yudao-framework/yudao-common/src/main/java/cn/iocoder/yudao/framework/common/util/http/HttpUtils.java",
                    "startLine": 142,
                    "endLine": 142,
                    "startColumn": 13,
                    "endColumn": 36,
                    "codeElementType": "RETURN_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-framework/yudao-common/src/main/java/cn/iocoder/yudao/framework/common/util/http/HttpUtils.java",
                    "startLine": 142,
                    "endLine": 142,
                    "startColumn": 20,
                    "endColumn": 35,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-framework/yudao-common/src/main/java/cn/iocoder/yudao/framework/common/util/http/HttpUtils.java",
                    "startLine": 138,
                    "endLine": 143,
                    "startColumn": 9,
                    "endColumn": 10,
                    "codeElementType": "TRY_STATEMENT",
                    "description": "extracted code to extracted method declaration",
                    "codeElement": null
                },
                {
                    "filePath": "yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/framework/sms/core/client/impl/AliyunSmsClient.java",
                    "startLine": 131,
                    "endLine": 182,
                    "startColumn": 5,
                    "endColumn": 6,
                    "codeElementType": "METHOD_DECLARATION",
                    "description": "source method declaration after extraction",
                    "codeElement": "private request(apiName String, queryParams TreeMap<String,Object>) : JSONObject"
                },
                {
                    "filePath": "yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/framework/sms/core/client/impl/AliyunSmsClient.java",
                    "startLine": 180,
                    "endLine": 180,
                    "startColumn": 31,
                    "endColumn": 92,
                    "codeElementType": "METHOD_INVOCATION",
                    "description": "extracted method invocation",
                    "codeElement": "HttpUtils.post(URL + \"?\" + queryString,headers,requestBody)"
                }
            ],
            "isStatic": true
        },
        "ref_id": 20,
        "extraction_results": {
            "success": true,
            "newCommitHash": "f39bd9b7a4e06fb78d7543cbacdfcf0b8f4a4fa2",
            "newBranchName": "extract-post-request-0c8ee55"
        }
    }
]